this.BX=this.BX||{};this.BX.Sign=this.BX.Sign||{};(function(e,s,t,a,i,l,o){"use strict";let r=e=>e,n,c,d,b,u,p,v,h,m,P;const L=["ui-btn","ui-btn-sm","ui-btn-light-border","ui-btn-round"];const _="sign-member-communication";var g=babelHelpers.classPrivateFieldLooseKey("editDocumentBtn");var f=babelHelpers.classPrivateFieldLooseKey("api");var y=babelHelpers.classPrivateFieldLooseKey("blocks");var F=babelHelpers.classPrivateFieldLooseKey("filledBlocks");var H=babelHelpers.classPrivateFieldLooseKey("menus");var B=babelHelpers.classPrivateFieldLooseKey("summaryContainer");var E=babelHelpers.classPrivateFieldLooseKey("langContainer");var N=babelHelpers.classPrivateFieldLooseKey("config");var O=babelHelpers.classPrivateFieldLooseKey("langSelector");var D=babelHelpers.classPrivateFieldLooseKey("createDocumentDetails");var T=babelHelpers.classPrivateFieldLooseKey("createTitleEditor");var I=babelHelpers.classPrivateFieldLooseKey("toggleTitleEditor");var M=babelHelpers.classPrivateFieldLooseKey("focusInput");var C=babelHelpers.classPrivateFieldLooseKey("modifyDocumentTitle");var w=babelHelpers.classPrivateFieldLooseKey("attachMenu");var S=babelHelpers.classPrivateFieldLooseKey("formatPhoneNumberForUi");var $=babelHelpers.classPrivateFieldLooseKey("getNormalizedPhoneNumber");var j=babelHelpers.classPrivateFieldLooseKey("updatePhoneAttr");var A=babelHelpers.classPrivateFieldLooseKey("showMemberInfo");var U=babelHelpers.classPrivateFieldLooseKey("createParties");var X=babelHelpers.classPrivateFieldLooseKey("updateCommunications");class K extends t.EventEmitter{constructor(e){super();Object.defineProperty(this,X,{value:Z});Object.defineProperty(this,U,{value:Q});Object.defineProperty(this,A,{value:J});Object.defineProperty(this,j,{value:q});Object.defineProperty(this,$,{value:W});Object.defineProperty(this,S,{value:z});Object.defineProperty(this,w,{value:Y});Object.defineProperty(this,C,{value:R});Object.defineProperty(this,M,{value:G});Object.defineProperty(this,I,{value:k});Object.defineProperty(this,T,{value:V});Object.defineProperty(this,D,{value:x});Object.defineProperty(this,g,{writable:true,value:void 0});Object.defineProperty(this,f,{writable:true,value:void 0});Object.defineProperty(this,y,{writable:true,value:void 0});Object.defineProperty(this,F,{writable:true,value:void 0});Object.defineProperty(this,H,{writable:true,value:void 0});Object.defineProperty(this,B,{writable:true,value:void 0});Object.defineProperty(this,E,{writable:true,value:void 0});Object.defineProperty(this,N,{writable:true,value:void 0});Object.defineProperty(this,O,{writable:true,value:void 0});babelHelpers.classPrivateFieldLooseBase(this,N)[N]=e;this.setEventNamespace("BX.Sign.V2.DocumentSummary");babelHelpers.classPrivateFieldLooseBase(this,g)[g]=s.Tag.render(n||(n=r`
			<span
				class="${0}"
				onclick="${0}"
			>
				${0}
			</span>
		`),L.join(" "),(()=>this.emit("showEditor")),s.Loc.getMessage("SIGN_DOCUMENT_INFO_EDIT"));babelHelpers.classPrivateFieldLooseBase(this,f)[f]=new i.Api;babelHelpers.classPrivateFieldLooseBase(this,y)[y]=s.Tag.render(c||(c=r`
			<p class="sign-document-info__details_structure"></p>
		`));babelHelpers.classPrivateFieldLooseBase(this,F)[F]=s.Tag.render(d||(d=r`
			<p class="sign-document-info__details_structure"></p>
		`));babelHelpers.classPrivateFieldLooseBase(this,O)[O]=new o.LangSelector(babelHelpers.classPrivateFieldLooseBase(this,N)[N].region,babelHelpers.classPrivateFieldLooseBase(this,N)[N].languages);babelHelpers.classPrivateFieldLooseBase(this,E)[E]=s.Tag.render(b||(b=r`
			<div class="sign-blank-selector__lang-container">
				${0}
				<span data-hint="${0}"></span>
			</div>
		`),babelHelpers.classPrivateFieldLooseBase(this,O)[O].getLayout(),s.Loc.getMessage("SIGN_DOCUMENT_LANGUAGE_BUTTON_INFO"));BX.UI.Hint.init(babelHelpers.classPrivateFieldLooseBase(this,E)[E]);babelHelpers.classPrivateFieldLooseBase(this,H)[H]=[];this.documentData={};this.entityData={};this.communications={}}getLayout(){babelHelpers.classPrivateFieldLooseBase(this,O)[O].setDocumentUid(this.documentData.uid);babelHelpers.classPrivateFieldLooseBase(this,B)[B]=s.Tag.render(u||(u=r`
			<div class="sign-document-info">
				<div class="sign-document-indo__summary-title-wrapper">
					<p class="sign-document-info__title">
						${0}
					</p>
					${0}
				</div>
				<div class="sign-document-info__summary">
					${0}
					${0}
				</div>
				${0}
			</div>
		`),s.Loc.getMessage("SIGN_DOCUMENT_INFO_SEND"),babelHelpers.classPrivateFieldLooseBase(this,E)[E],babelHelpers.classPrivateFieldLooseBase(this,D)[D](),babelHelpers.classPrivateFieldLooseBase(this,g)[g],babelHelpers.classPrivateFieldLooseBase(this,U)[U]());return babelHelpers.classPrivateFieldLooseBase(this,B)[B]}highlightCommunicationWithError(e){const t=babelHelpers.classPrivateFieldLooseBase(this,B)[B].querySelectorAll(`.sign-document-info__party_id-means[data-phone-normalized="${e}"]`);t.forEach((e=>{const t=e.closest(".sign-document-info__party");s.Dom.addClass(t,"--validation-error")}))}resetCommunicationErrors(){const e=babelHelpers.classPrivateFieldLooseBase(this,B)[B].querySelectorAll(".sign-document-info__party");e.forEach((e=>{s.Dom.removeClass(e,"--validation-error")}))}renderDocumentDetails(){var e;const t=(e=this.documentData.blocks)!=null?e:[];const a=t.filter((e=>e.party===1)).length;const i=t.filter((e=>e.party>=2)).length;const l=s.Loc.getMessage("SIGN_DOCUMENT_INFO_ADDED_BLOCKS",{"#CNT#":a});const o=s.Loc.getMessage("SIGN_DOCUMENT_INFO_ADDED_FILLED_FIELDS",{"#CNT#":i});babelHelpers.classPrivateFieldLooseBase(this,y)[y].textContent=l;babelHelpers.classPrivateFieldLooseBase(this,F)[F].textContent=o}}function x(){var e;this.renderDocumentDetails();return s.Tag.render(p||(p=r`
			<div class="sign-document-info__details">
				<div class="sign-document-info__details_title">
					<span>${0}</span>
					<span
						class="sign-document-info__details_edit-title-btn"
						onclick="${0}"
					>
					</span>
				</div>
				${0}
				${0}
			</div>
		`),s.Text.encode((e=this.documentData.title)!=null?e:""),(({target:e})=>{babelHelpers.classPrivateFieldLooseBase(this,I)[I](e,true)}),babelHelpers.classPrivateFieldLooseBase(this,y)[y],babelHelpers.classPrivateFieldLooseBase(this,F)[F])}function V(){var e;const t=[...L.slice(0,2),"ui-btn-primary","sign-document-info__title-editor_ok-btn"].join(" ");const a=[...L.slice(0,3),"sign-document-info__title-editor_discard-btn"].join(" ");const i=s.Tag.render(v||(v=r`<input type="text" class="ui-ctl-element" />`));i.value=(e=this.documentData.title)!=null?e:"";babelHelpers.classPrivateFieldLooseBase(this,M)[M](i);return s.Tag.render(h||(h=r`
			<div class="sign-document-info__title-editor">
				<div class="sign-document-info__title-editor_controls">
					<span class="ui-ctl ui-ctl-textbox ui-ctl-w100">
						${0}
					</span>
					<span
						class="${0}"
						onclick="${0}"
					>
					</span>
					<span
						class="${0}"
						onclick="${0}"
					>
					</span>
				</div>
				<p class="sign-document-info__title-editor_help">
					${0}
				</p>
			</div>
		`),i,t,(async({target:e})=>{s.Dom.addClass(e,"ui-btn-wait");await babelHelpers.classPrivateFieldLooseBase(this,C)[C](i.value);s.Dom.removeClass(e,"ui-btn-wait");babelHelpers.classPrivateFieldLooseBase(this,I)[I](e,false)}),a,(({target:e})=>{babelHelpers.classPrivateFieldLooseBase(this,I)[I](e,false)}),s.Loc.getMessage("SIGN_DOCUMENT_INFO_TITLE_EDITOR_HELP"))}function k(e,t){const a=e.closest(".sign-document-info__summary");if(t){s.Dom.clean(a);s.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,T)[T](),a);return}s.Dom.replace(a.firstElementChild,babelHelpers.classPrivateFieldLooseBase(this,D)[D]());s.Dom.append(babelHelpers.classPrivateFieldLooseBase(this,g)[g],a)}function G(e){const s=new MutationObserver((()=>{if(e.isConnected){e.focus();s.disconnect()}}));s.observe(document.body,{childList:true,subtree:true})}async function R(e){const{title:s="",uid:t=""}=this.documentData;if(s===e){return}try{await babelHelpers.classPrivateFieldLooseBase(this,f)[f].modifyTitle(t,e);this.documentData={...this.documentData,title:e};this.emit("changeTitle",{newValue:e})}catch(e){console.error(e)}}function Y(e,t){let i=[];const l=`${_}-${t.entityTypeId}-${t.id}`;if(babelHelpers.classPrivateFieldLooseBase(this,H)[H][l]){let e=babelHelpers.classPrivateFieldLooseBase(this,H)[H][l].getMenuItems();const s=(e,s,t)=>{const a=e[t];e[t]=e[s];e[s]=a};while(e.length>1){if(e[0].id==="show-member"){s(e,0,1);continue}babelHelpers.classPrivateFieldLooseBase(this,H)[H][l].removeMenuItem(e[0].id);e=babelHelpers.classPrivateFieldLooseBase(this,H)[H][l].getMenuItems()}}babelHelpers.classPrivateFieldLooseBase(this,f)[f].loadCommunications(t.uid).then((async s=>{var a,o,r,n,c;let d={};const b=await babelHelpers.classPrivateFieldLooseBase(this,f)[f].loadRestrictions();const u=s=>{let a=s.VALUE;if((s==null?void 0:s.TYPE)==="PHONE"&&BX.PhoneNumberParser){BX.PhoneNumberParser.getInstance().parse(s.VALUE).then((e=>{a=e.format(BX.PhoneNumber.Format.INTERNATIONAL)}))}if((s==null?void 0:s.TYPE)==="PHONE"&&b.smsAllowed||(s==null?void 0:s.TYPE)==="EMAIL"&&Object.keys(d).length===0){d=s}return{text:a,onclick:({target:i})=>{babelHelpers.classPrivateFieldLooseBase(this,X)[X](t,s);e.firstElementChild.textContent=a;babelHelpers.classPrivateFieldLooseBase(this,H)[H][l].close();babelHelpers.classPrivateFieldLooseBase(this,j)[j](e,(s==null?void 0:s.TYPE)==="PHONE"?s.VALUE:null)}}};i=[...s!=null&&s.EMAIL?s==null?void 0:s.EMAIL.map((e=>u(e))):[],...s!=null&&s.PHONE?await Promise.all(s==null?void 0:s.PHONE.map((async e=>{const s=u(e);s.text=await babelHelpers.classPrivateFieldLooseBase(this,S)[S](s.text);return s}))):[]];i.map((e=>babelHelpers.classPrivateFieldLooseBase(this,H)[H][l].addMenuItem(e,null)));babelHelpers.classPrivateFieldLooseBase(this,X)[X](t,d);e.firstElementChild.textContent=((a=d)==null?void 0:a.TYPE)==="PHONE"?await babelHelpers.classPrivateFieldLooseBase(this,S)[S]((o=d)==null?void 0:o.VALUE):(r=d)==null?void 0:r.VALUE;babelHelpers.classPrivateFieldLooseBase(this,j)[j](e,((n=d)==null?void 0:n.TYPE)==="PHONE"?await babelHelpers.classPrivateFieldLooseBase(this,$)[$]((c=d)==null?void 0:c.VALUE):null)})).catch((()=>{}));i.push({id:"show-member",text:s.Loc.getMessage("SIGN_DOCUMENT_INFO_OPEN_VIEW"),onclick:()=>{babelHelpers.classPrivateFieldLooseBase(this,A)[A](e,t);babelHelpers.classPrivateFieldLooseBase(this,H)[H][l].close()}});if(!babelHelpers.classPrivateFieldLooseBase(this,H)[H][l]){babelHelpers.classPrivateFieldLooseBase(this,H)[H][l]=a.MenuManager.create({id:l,items:i});const s=babelHelpers.classPrivateFieldLooseBase(this,H)[H][l].getPopupWindow();s.setBindElement(e)}e.firstElementChild.textContent=i[0].text;return babelHelpers.classPrivateFieldLooseBase(this,H)[H][l]}async function z(e){let s=e;if(BX.PhoneNumberParser){s=await BX.PhoneNumberParser.getInstance().parse(e).then((e=>e.format(BX.PhoneNumber.Format.INTERNATIONAL)))}return s}async function W(e){if(BX.PhoneNumberParser){const s=await BX.PhoneNumberParser.getInstance().parse(e);return s.isValid()?s.format(BX.PhoneNumber.Format.E164):s.rawNumber}return e}function q(e,t=null){if(s.Type.isStringFilled(t)){s.Dom.attr(e,"data-phone-normalized",t)}else{e.removeAttribute("data-phone-normalized")}}function J(e,t){const{Instance:a}=s.Reflection.getClass("BX.SidePanel");a.open(t.url,{cacheable:false,allowChangeHistory:false,events:{onClose:()=>{babelHelpers.classPrivateFieldLooseBase(this,w)[w](e,t)}}})}function Q(){const e=[{partyTitle:s.Loc.getMessage("SIGN_DOCUMENT_INFO_FIRST_PARTY"),entityData:this.entityData.company},{partyTitle:s.Loc.getMessage("SIGN_DOCUMENT_INFO_PARTNER"),entityData:this.entityData.contact}];Object.keys(a.MenuManager.Data).forEach((e=>{if(e.includes(_)){a.MenuManager.destroy(e)}}));babelHelpers.classPrivateFieldLooseBase(this,H)[H]=[];return e.map((e=>{const{partyTitle:t,entityData:a}=e;const{title:i}=a;const l=s.Tag.render(m||(m=r`
				<span
					class="sign-document-info__party_id-means"
					onclick="${0}"
				>
					<span></span>
				</span>
			`),(()=>o.show()));const o=babelHelpers.classPrivateFieldLooseBase(this,w)[w](l,a);return s.Tag.render(P||(P=r`
				<div class="sign-document-info__party">
					<div class="sign-document-info__party_summary">
						<p class="sign-document-info__party_title">${0}</p>
						<span class="sign-document-info__party_member-name">
							${0}
						</span>
						<span class="sign-document-info__party_status">
							${0}
						</span>
					</div>
					<div class="sign-document-info__party_id">
						<p class="sign-document-info__party_title">
							${0}
						</p>
						${0}
					</div>
				</div>
			`),t,s.Text.encode(i),s.Loc.getMessage("SIGN_DOCUMENT_INFO_NOT_SIGNED"),s.Loc.getMessage("SIGN_DOCUMENT_INFO_ID"),l)}))}function Z(e,s){if(typeof s==="undefined"){return}const{TYPE:t,VALUE:a}=s;this.communications={...this.communications,[e.type]:{type:t,value:a}};this.resetCommunicationErrors()}e.DocumentSummary=K})(this.BX.Sign.V2=this.BX.Sign.V2||{},BX,BX.Event,BX.Main,BX.Sign.V2,BX.UI,BX.Sign.V2);
//# sourceMappingURL=document-summary.bundle.map.js