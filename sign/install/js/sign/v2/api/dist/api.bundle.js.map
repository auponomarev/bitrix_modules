{"version":3,"file":"api.bundle.js","sources":["../src/index.js"],"sourcesContent":["import { ajax, Text } from 'main.core';\nimport { UI } from 'ui.notification';\nimport type {\n\tLoadedDocumentData,\n\tCommunication,\n\tBlockData,\n\tLoadedBlock,\n} from './type';\n\nexport class Api\n{\n\t#post(endpoint: string, data: Object = null, notifyError: boolean): Promise<Object>\n\t{\n\t\treturn this.#request('POST', endpoint, data, notifyError);\n\t}\n\n\tasync #request(\n\t\tmethod: string,\n\t\tendpoint: string,\n\t\tdata: ?Object,\n\t\tnotifyError: ?boolean = true,\n\t): Promise<Object>\n\t{\n\t\tconst config = { method };\n\t\tif (method === 'POST')\n\t\t{\n\t\t\tObject.assign(config, { data }, {\n\t\t\t\tpreparePost: false,\n\t\t\t\theaders: [{\n\t\t\t\t\tname: 'Content-Type',\n\t\t\t\t\tvalue: 'application/json',\n\t\t\t\t}],\n\t\t\t});\n\t\t}\n\n\t\ttry\n\t\t{\n\t\t\tconst response = await ajax.runAction(endpoint, config);\n\t\t\tif (response.errors?.length > 0)\n\t\t\t{\n\t\t\t\tthrow new Error(response.errors[0].message);\n\t\t\t}\n\n\t\t\treturn response.data;\n\t\t}\n\t\tcatch (ex)\n\t\t{\n\t\t\tif (!notifyError)\n\t\t\t{\n\t\t\t\treturn ex;\n\t\t\t}\n\n\t\t\tconst { message = `Error in ${endpoint}`, errors = [] } = ex;\n\t\t\tconst content = errors[0]?.message ?? message;\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: Text.encode(content),\n\t\t\t\tautoHideDelay: 4000,\n\t\t\t});\n\n\t\t\tthrow ex;\n\t\t}\n\t}\n\n\tregister(blankId: string): Promise<{ uid: string; }>\n\t{\n\t\treturn this.#post('sign.api_v1.document.register', { blankId });\n\t}\n\n\tupload(uid: string): Promise<[]>\n\t{\n\t\treturn this.#post('sign.api_v1.document.upload', { uid });\n\t}\n\n\tgetPages(uid: string): Promise<Array<{ url: string; }>>\n\t{\n\t\treturn this.#post('sign.api_v1.document.pages.list', { uid }, false);\n\t}\n\n\tloadBlanks(page: number): Promise<Array<{ title: string; id: number }>>\n\t{\n\t\treturn this.#post('sign.api_v1.document.blank.list', { page });\n\t}\n\n\tcreateBlank(files: Array<string>): Promise<{ id: number; }>\n\t{\n\t\treturn this.#post('sign.api_v1.document.blank.create', { files });\n\t}\n\n\tsaveBlank(documentUid: string, blocks: []): Promise<[]>\n\t{\n\t\treturn this.#post('sign.api_v1.document.blank.block.save', { documentUid, blocks }, false);\n\t}\n\n\tloadBlocksData(documentUid: string, blocks: []): Promise<BlockData>\n\t{\n\t\treturn this.#post('sign.api_v1.document.blank.block.loadData', { documentUid, blocks });\n\t}\n\n\tchangeDocument(uid: string, blankId: number): Promise<{ uid: string; }>\n\t{\n\t\treturn this.#post('sign.api_v1.document.changeBlank', { uid, blankId });\n\t}\n\n\tchangeDocumentLanguages(uid: string, lang: string): Promise\n\t{\n\t\treturn this.#post('sign.api_v1.document.changeDocumentLanguages', { uid, lang });\n\t}\n\n\tloadDocument(uid: string): Promise<LoadedDocumentData>\n\t{\n\t\treturn this.#post('sign.api_v1.document.load', { uid });\n\t}\n\n\tconfigureDocument(uid: string): Promise<[]>\n\t{\n\t\treturn this.#post('sign.api_v1.document.configure', { uid });\n\t}\n\n\tloadBlocksByDocument(documentUid: string): Promise<Array<LoadedBlock>>\n\t{\n\t\treturn this.#post('sign.api_v1.document.blank.block.loadByDocument', {\n\t\t\tdocumentUid,\n\t\t});\n\t}\n\n\tstartSigning(uid: string): Promise<[]>\n\t{\n\t\treturn this.#post('sign.api_v1.document.signing.start', { uid });\n\t}\n\n\taddMember(\n\t\tdocumentUid: string,\n\t\tentityType: string,\n\t\tentityId: number,\n\t\tparty: number,\n\t\tpresetId: number,\n\t): Promise<{ uid: string; }>\n\t{\n\t\treturn this.#post('sign.api_v1.document.member.add', {\n\t\t\tdocumentUid,\n\t\t\tentityType,\n\t\t\tentityId,\n\t\t\tparty,\n\t\t\tpresetId,\n\t\t});\n\t}\n\n\tremoveMember(uid: string): Promise<[]>\n\t{\n\t\treturn this.#post('sign.api_v1.document.member.remove', { uid });\n\t}\n\n\tloadMembers(documentUid: string): Promise<Array<{ entityId: number; uid: string; }>>\n\t{\n\t\treturn this.#post('sign.api_v1.document.member.load', { documentUid });\n\t}\n\n\tmodifyCommunicationChannel(\n\t\tuid: string,\n\t\tchannelType: string,\n\t\tchannelValue: string,\n\t): Promise<[]>\n\t{\n\t\treturn this.#post('sign.api_v1.document.member.modifyCommunicationChannel', {\n\t\t\tuid,\n\t\t\tchannelType,\n\t\t\tchannelValue,\n\t\t});\n\t}\n\n\tloadCommunications(uid: String): Promise<Array<Communication>>\n\t{\n\t\treturn this.#post('sign.api_v1.document.member.loadCommunications', { uid });\n\t}\n\n\tmodifyTitle(uid: string, title: string): Promise<[]>\n\t{\n\t\treturn this.#post('sign.api_v1.document.modifyTitle', {\n\t\t\tuid,\n\t\t\ttitle,\n\t\t});\n\t}\n\n\tmodifyInitiator(uid: string, initiator: string): Promise<[]>\n\t{\n\t\treturn this.#post('sign.api_v1.document.modifyInitiator', {\n\t\t\tuid,\n\t\t\tinitiator,\n\t\t});\n\t}\n\n\tmodifyLanguageId(uid: string, langId: string): Promise\n\t{\n\t\treturn this.#post('sign.api_v1.document.modifyLangId', {\n\t\t\tuid,\n\t\t\tlangId\n\t\t});\n\t}\n\n\tloadLanguages(): Promise\n\t{\n\t\treturn this.#post('sign.api_v1.document.loadLanguage');\n\t}\n\n\trefreshEntityNumber(documentUid: string): Promise<[]>\n\t{\n\t\treturn this.#post('sign.api_v1.document.refreshEntityNumber', {\n\t\t\tdocumentUid,\n\t\t});\n\t}\n\n\tchangeDomain(): Promise\n\t{\n\t\treturn this.#post('sign.api_v1.portal.changeDomain');\n\t}\n\n\tloadRestrictions(): Promise<{ smsAllowed: boolean; }>\n\t{\n\t\treturn this.#post('sign.api_v1.portal.hasRestrictions');\n\t}\n\n\tsaveStamp(memberUid: String, fileId: string): Promise<{ id: number; srcUri: string; }>\n\t{\n\t\treturn this.#post('sign.api_v1.document.member.saveStamp', {\n\t\t\tmemberUid, fileId,\n\t\t});\n\t}\n}\n"],"names":["Api","register","blankId","upload","uid","getPages","loadBlanks","page","createBlank","files","saveBlank","documentUid","blocks","loadBlocksData","changeDocument","changeDocumentLanguages","lang","loadDocument","configureDocument","loadBlocksByDocument","startSigning","addMember","entityType","entityId","party","presetId","removeMember","loadMembers","modifyCommunicationChannel","channelType","channelValue","loadCommunications","modifyTitle","title","modifyInitiator","initiator","modifyLanguageId","langId","loadLanguages","refreshEntityNumber","changeDomain","loadRestrictions","saveStamp","memberUid","fileId","endpoint","data","notifyError","method","config","Object","assign","preparePost","headers","name","value","response","ajax","runAction","errors","length","Error","message","ex","content","UI","Notification","Center","notify","Text","encode","autoHideDelay"],"mappings":"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"}