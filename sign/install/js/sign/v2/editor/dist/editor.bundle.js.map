{"version":3,"file":"editor.bundle.js","sources":["../src/blocks/dummy.js","../src/blocks/date.js","../src/blocks/myrequisites.js","../../../document/src/ui.js","../src/blocks/mysign.js","../src/blocks/mystamp.js","../src/blocks/number.js","../src/blocks/reference.js","../src/blocks/myreference.js","../src/blocks/requisites.js","../src/blocks/stamp.js","../src/blocks/sign.js","../src/blocks/text.js","../src/blocks/ui.js","../src/blocks/style.js","../src/blocks/block.js","../src/blocks/resize.js","../src/blocks/blocksManager.js","../src/index.js"],"sourcesContent":["import { Tag, Text as TextFormat } from 'main.core';\nimport Block from './block';\nimport { EventEmitter } from \"main.core.events\";\n\nexport default class Dummy extends EventEmitter\n{\n\tblock: Block;\n\tdata: any = {};\n\tevents= {\n\t\tonChange: 'onChange',\n\t\tonColorStyleChange: 'onColorStyleChange',\n\t};\n\n\tstatic defaultTextBlockPaddingStyles = {\n\t\tpadding: \"5px 8px\"\n\t};\n\n\t/**\n\t * Constructor.\n\t * @param {Block} block\n\t */\n\tconstructor(block: Block)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.Editor.Blocks.Dummy')\n\t\tthis.block = block;\n\t}\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns true if style panel mast be showed.\n\t * @return {boolean}\n\t */\n\tisStyleAllowed(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.data = data ? data : {};\n\t}\n\n\t/**\n\t * Changes only text key in data.\n\t * @param {string} text\n\t */\n\tsetText(text: string)\n\t{\n\t\tthis.setData({ text });\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 250,\n\t\t\theight: 28\n\t\t};\n\t}\n\n\t/**\n\t * Returns current data.\n\t * @return {any}\n\t */\n\tgetData(): any\n\t{\n\t\treturn this.data;\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\treturn null;\n\t}\n\n\t/**\n\t * @return {HTMLElement | null}\n\t */\n\tgetBlockCaption(): ?HTMLElement\n\t{\n\t\treturn null;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\treturn Tag.render`\n\t\t\t<div>\n\t\t\t\t${TextFormat.encode(this.data.text || '').toString().replaceAll('[br]', '<br>')}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Calls when block starts being resized or moved.\n\t */\n\tonStartChangePosition()\n\t{\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t}\n\n\t/**\n\t * Calls when block saved.\n\t */\n\tonSave()\n\t{\n\t}\n\n\t/**\n\t * Calls when block removed.\n\t */\n\tonRemove()\n\t{\n\t}\n\n\t/**\n\t * Calls when click was out the block.\n\t */\n\tonClickOut()\n\t{\n\t\tthis.block.forceSave();\n\t}\n\n\tonChange(): void\n\t{\n\t\tthis.emit(this.events.onChange)\n\t}\n\n\tgetStyles(): {[styleName: string]: string}\n\t{\n\t\treturn {};\n\t}\n\n\tchangeStyleColor(color: string): void\n\t{}\n}\n","import 'date';\nimport { Loc, Tag, Dom } from 'main.core';\n\nimport Dummy from './dummy';\n\nexport default class Date extends Dummy\n{\n\t#calendar: BX.JCCalendar;\n\t#calendarOpened: boolean = false;\n\t#date: string;\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 105,\n\t\t\theight: 28\n\t\t};\n\t}\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.data = data ? data : {};\n\t\tthis.#date = this.data.text;\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t */\n\tonActionClick()\n\t{\n\t\tthis.#calendar = BX.calendar({\n\t\t\tnode: this.block.getLayout(),\n\t\t\tfield: this.getViewContent(),\n\t\t\tvalue: this.#date,\n\t\t\tbTime: false,\n\t\t\tcallback_after: (date) => {\n\t\t\t\tthis.setText(\n\t\t\t\t\tBX.date.format(BX.date.convertBitrixFormat(BX.message('FORMAT_DATE')), date, null)\n\t\t\t\t);\n\t\t\t\tthis.block.renderView();\n\t\t\t}\n\t\t});\n\n\t\tthis.#calendarOpened = true;\n\t\tconst targetContainer = document.querySelector('.sign-editor__content');\n\t\tconst { popup } = this.#calendar;\n\t\tpopup.targetContainer = targetContainer;\n\t\tif (popup.popupContainer.parentElement !== targetContainer)\n\t\t{\n\t\t\tDom.append(popup.popupContainer, targetContainer);\n\t\t\tpopup.adjustPosition();\n\t\t}\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement}\n\t */\n\tgetActionButton(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t\t${Loc.getMessage('SIGN_JS_DOCUMENT_DATE_ACTION_BUTTON')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Closes calendar if open.\n\t */\n\t#closeCalendar()\n\t{\n\t\tif (this.#calendar)\n\t\t{\n\t\t\tthis.#calendar.Close();\n\t\t\tthis.#calendarOpened = false;\n\t\t}\n\t}\n\n\t/**\n\t * Calls when block starts being resized or moved.\n\t */\n\tonStartChangePosition()\n\t{\n\t\tthis.#closeCalendar();\n\t}\n\n\t/**\n\t * Calls when block saved.\n\t */\n\tonSave()\n\t{\n\t\tthis.#closeCalendar();\n\t}\n\n\t/**\n\t * Calls when block removed.\n\t */\n\tonRemove()\n\t{\n\t\tthis.#closeCalendar();\n\t}\n\n\t/**\n\t * Calls when click was out the block.\n\t */\n\tonClickOut()\n\t{\n\t\tif (!this.#calendarOpened)\n\t\t{\n\t\t\tthis.block.forceSave();\n\t\t}\n\n\t\tthis.#calendarOpened = false;\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Date.defaultTextBlockPaddingStyles };\n\t}\n}\n","import { FieldsetViewer } from 'crm.requisite.fieldset-viewer';\nimport { Cache, Loc, Tag, Text } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport { UI } from 'ui.notification';\n\nimport Dummy from './dummy';\n\nexport default class MyRequisites extends Dummy\n{\n\t#cache = new Cache.MemoryCache();\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): { width: number, height: number }\n\t{\n\t\treturn {\n\t\t\twidth: 250,\n\t\t\theight: 220,\n\t\t};\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t * @param {PointerEvent} event\n\t */\n\t#onActionClick(event: PointerEvent)\n\t{\n\t\tevent.stopPropagation();\n\t\tthis.#getFieldsetViewer().show();\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement}\n\t */\n\tgetActionButton(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\" data-id=\"action-${this.block.getCode()}\">\n\t\t\t\t\t${Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_ACTION_BUTTON')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...MyRequisites.defaultTextBlockPaddingStyles };\n\t}\n\n\t#getFieldsNameBlackList(): Array<string>\n\t{\n\t\treturn [\n\t\t\t'ADDRESS',\n\t\t\t'REG_ADDRESS',\n\t\t];\n\t}\n\n\t#getCreateFieldTypeNamesBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'file',\n\t\t\t'employee',\n\t\t\t'boolean',\n\t\t\t'money',\n\t\t]);\n\t}\n\n\t#filterRequisiteCreateFields(fields: Array<{ name: string }>): Array<Object>\n\t{\n\t\treturn fields.filter(\n\t\t\t(createFieldType) => !this.#getCreateFieldTypeNamesBlackList().has(createFieldType.name),\n\t\t);\n\t}\n\n\t#getFieldsetViewer(): FieldsetViewer\n\t{\n\t\treturn this.#cache.remember('fieldSetViewer', () => {\n\t\t\tconst blocksManager = this.block.blocksManager;\n\t\t\tconst member = blocksManager.getMemberByPart(this.block.getMemberPart());\n\n\t\t\tconst { cid, entityTypeId, presetId } = member;\n\n\t\t\tconst fieldsetViewer = new FieldsetViewer({\n\t\t\t\tentityTypeId,\n\t\t\t\tentityId: cid,\n\t\t\t\tevents: {\n\t\t\t\t\tonClose: () => {\n\t\t\t\t\t\tthis.block.assign();\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tfieldListEditorOptions: {\n\t\t\t\t\tfieldsPanelOptions: {\n\t\t\t\t\t\tfilter: {\n\t\t\t\t\t\t\t'+categories': [\n\t\t\t\t\t\t\t\t'COMPANY',\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t'+fields': [\n\t\t\t\t\t\t\t\t'list',\n\t\t\t\t\t\t\t\t'string',\n\t\t\t\t\t\t\t\t'date',\n\t\t\t\t\t\t\t\t'typed_string',\n\t\t\t\t\t\t\t\t'text',\n\t\t\t\t\t\t\t\t'datetime',\n\t\t\t\t\t\t\t\t'enumeration',\n\t\t\t\t\t\t\t\t'address',\n\t\t\t\t\t\t\t\t'url',\n\t\t\t\t\t\t\t\t'double',\n\t\t\t\t\t\t\t\t'integer',\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t'-fields': [\n\t\t\t\t\t\t\t\t({ entity_field_name: fieldName }) => this.#getFieldsNameBlackList().includes(fieldName),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfieldsFactory: {\n\t\t\t\t\t\t\tfilter: this.#filterRequisiteCreateFields.bind(this),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tpresetId,\n\t\t\t\t\t\tcontrollerOptions: {\n\t\t\t\t\t\t\thideVirtual: 1,\n\t\t\t\t\t\t\thideRequisites: 0,\n\t\t\t\t\t\t\thideSmartDocument: 1,\n\t\t\t\t\t\t\tpresetId,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t});\n\t\t\tfieldsetViewer.subscribe('onFieldSetLoadError', this.#onFieldsetViewerFieldsetLoadError.bind(this));\n\n\t\t\treturn fieldsetViewer;\n\t\t});\n\t}\n\n\t#onFieldsetViewerFieldsetLoadError(event: BaseEvent<{ requestErrors: Array<{ message: string, code: string }> }>)\n\t{\n\t\tthis.#getFieldsetViewer().hide();\n\t\tconst hasAccessDeniedError = event.getData().requestErrors.some((error) => error.code === 'ACCESS_DENIED');\n\t\tif (hasAccessDeniedError)\n\t\t{\n\t\t\tUI.Notification.Center.notify({\n\t\t\t\tcontent: Text.encode(Loc.getMessage('SIGN_EDITOR_ERROR_REQUISITE_BLOCK_REQUISITE_ACCESS_DENIED')),\n\t\t\t\tautoHideDelay: 3000,\n\t\t\t\twidth: 480,\n\t\t\t});\n\t\t}\n\t}\n}\n","import { Dom, Event, Loc, Tag, Text as TextFormat, Reflection, Type } from 'main.core';\nimport { UI as SignUI } from 'sign.ui';\nimport { MemberItem } from './types/document';\n\nimport './style.css';\nimport 'color_picker';\n\ntype BlockLayoutOptions = {\n\tonRemove: () => {},\n\tonSave: () => {}\n};\n\nexport type ColorPickerOptions = {\n\tcolors?: Array<Array<string>>,\n\tallowCustomColor?: boolean,\n\tselectedColor?: string,\n\tcolorPreview?: boolean,\n}\n\nconst ColorPicker = Reflection.getClass('BX.ColorPicker');\n\nexport default class UI\n{\n\t/**\n\t * Sets width/height/top/left to element.\n\t * @param {HTMLElement} element\n\t * @param {{[key: string]: number}} rect\n\t */\n\tstatic setRect(element: HTMLElement, rect: {[key: string]: number})\n\t{\n\t\tObject.keys(rect).map(key => {\n\t\t\trect[key] = parseInt(rect[key]) + 'px';\n\t\t});\n\t\tDom.style(element, rect);\n\t}\n\n\t/**\n\t * Returns block's layout.\n\t * @param {BlockLayoutOptions} options Layout options.\n\t * @return {HTMLElement}\n\t */\n\tstatic getBlockLayout(options: BlockLayoutOptions): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-wrapper\">\n\t\t\t\t<div class=\"sign-document__block-panel--wrapper\" data-role=\"sign-block__actions\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-document__block-content\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-document__block-actions\">\n\t\t\t\t\t<div class=\"sign-document__block-actions--wrapper\">\n\t\t\t\t\t\t<button class=\"sign-document__block-actions-btn --remove sign-block-action-remove\" data-role=\"removeAction\" onclick=\"${options.onRemove}\"></button>\n\t\t\t\t\t\t<button class=\"sign-document__block-actions-btn --save sign-block-action-save\" data-role=\"saveAction\" onclick=\"${options.onSave}\"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns member selector for block.\n\t * @param {Array<MemberItem>} members All document's members.\n\t * @param {number} selectedValue Selected member.\n\t * @param {() => {}} onChange Handler on change value.\n\t * @return {HTMLElement}\n\t */\n\tstatic getMemberSelector(members: Array<MemberItem>, selectedValue: number,  onChange: () => {}): HTMLElement\n\t{\n\t\tconst menuItems = {};\n\t\tlet selectedName = Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET');\n\n\t\tmembers.map(member => {\n\t\t\tmember.name = member.name || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET');\n\t\t\tmenuItems[member.part] = member.name;\n\n\t\t\tif (member.part === selectedValue)\n\t\t\t{\n\t\t\t\tselectedName = member.name;\n\t\t\t}\n\t\t});\n\n\t\tconst memberSelector = (members.length > 1)\n\t\t\t? Tag.render`<span>${TextFormat.encode(selectedName)}</span>`\n\t\t\t: Tag.render`<i>${TextFormat.encode(selectedName)}</i>`;\n\n\t\tif (members.length > 1)\n\t\t{\n\t\t\tSignUI.bindSimpleMenu({\n\t\t\t\tbindElement: memberSelector,\n\t\t\t\titems: menuItems,\n\t\t\t\tactionHandler: value => {\n\t\t\t\t\tmemberSelector.innerHTML = menuItems[value];\n\t\t\t\t\tonChange(parseInt(value));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-block-member-wrapper\">\n\t\t\t\t${memberSelector}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns resizing area's layout.\n\t * @return {HTMLElement}\n\t */\n\tstatic getResizeArea(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__resize-area\">\n\t\t\t\t<div class=\"sign-area-resizable-controls\">\n\t\t\t\t\t<span class=\"sign-document__move-control\"></span>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-top\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --right-top\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-right\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --right-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --left-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-left\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns style panel layout.\n\t * @return {HTMLElement}\n\t */\n\tstatic getStylePanel(\n\t\tactionHandler: (actionName: string, actionValue: string) => {},\n\t\tcollectStyles: {[key: string]: string},\n\t): HTMLElement\n\t{\n\t\t// font family selector\n\t\tconst fonts = {\n\t\t\t'\"Times New Roman\", Times':   '<span style=\"font-family: \\'Times New Roman\\', Times\">Times New Roman</span>',\n\t\t\t'\"Courier New\"':              '<span style=\"font-family: \\'Courier New\\'\">Courier New</span>',\n\t\t\t'Arial, Helvetica':           '<span style=\"font-family: Arial, Helvetica\">Arial / Helvetica</span>',\n\t\t\t'\"Arial Black\", Gadget':      '<span style=\"font-family: \\'Arial Black\\', Gadget\">Arial Black</span>',\n\t\t\t'Tahoma, Geneva':             '<span style=\"font-family: Tahoma, Geneva\">Tahoma / Geneva</span>',\n\t\t\t'Verdana':                    '<span style=\"font-family: Verdana\">Verdana</span>',\n\t\t\t'Georgia, serif':             '<span style=\"font-family: Georgia, serif\">Georgia</span>',\n\t\t\t'monospace':                  '<span style=\"font-family: monospace\">monospace</span>',\n\t\t};\n\t\tconst fontFamily = Tag.render`<div class=\"sign-document__block-style-btn --btn-font-family\">${fonts[collectStyles['font-family']] || 'Font'}</div>`;\n\t\tSignUI.bindSimpleMenu({\n\t\t\tbindElement: fontFamily,\n\t\t\titems: fonts,\n\t\t\tactionHandler: value => {\n\t\t\t\tfontFamily.innerHTML = fonts[value];\n\t\t\t\tactionHandler('family', value);\n\t\t\t}\n\t\t});\n\n\t\t// font size selector\n\t\t\n\t\tlet fontSizereal = parseInt(collectStyles['font-size']);\n\t\tlet fontSizeValue = 14;\n\t\t\n\t\tif (fontSizereal) \n\t\t{\n\t\t\tfontSizeValue = fontSizereal;\n\t\t}\n\n\t\tconst fontSize = Tag.render`<div class=\"sign-document__block-style-btn --btn-fontsize\">${fontSizeValue+ 'px' || '<i></i>'}</div>`;\n\t\tSignUI.bindSimpleMenu({\n\t\t\tbindElement: fontSize,\n\t\t\titems: [\n\t\t\t\t'6px', '7px', '8px', '9px', '10px', '11px', '12px', '13px', '14px', '15px', '16px',\n\t\t\t\t'18px', '20px', '22px', '24px', '26px', '28px', '36px', '48px', '72px'\n\t\t\t],\n\t\t\tactionHandler: value => {\n\t\t\t\tfontSize.innerHTML = parseInt(value) + 'px';\n\t\t\t\tactionHandler('size', value);\n\t\t\t},\n\t\t\tcurrentValue: fontSizeValue,\n\t\t});\n\n\t\t// color\n\t\tconst { layout: fontColor } = UI.getColorSelectorBtn(\n\t\t\tcollectStyles.color ?? '#000',\n\t\t\t(color) => actionHandler('color', color),\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style--panel\">\n<!--\t\t\t\t<div class=\"sign-document__block-style&#45;&#45;move-control\"></div>-->\n\t\t\t\t${fontFamily}\n\t\t\t\t${fontSize}\n\t\t\t\t${fontColor}\n\t\t\t\t<div class=\"sign-document__block-style--separator\"></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-bold\" data-action=\"bold\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-italic\" data-action=\"italic\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-underline\" data-action=\"underline\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-strike\" data-action=\"through\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-left\" data-action=\"left\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-center\" data-action=\"center\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-right\" data-action=\"right\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-justify\" data-action=\"justify\"><i></i></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tstatic getColorSelectorBtn(\n\t\tdefaultColorPickerColor: string,\n\t\tonColorSelect: (string) => any,\n\t\tcolorPickerOptions: ColorPickerOptions = {},\n\t): { layout: HTMLElement, colorPicker: BX.ColorPicker }\n\t{\n\t\tconst layout = Tag.render`<div class=\"sign-document__block-style-btn --btn-color\">\n\t\t\t\t<span class=\"sign-document__block-style-btn--color-block\"></span> \n\t\t\t\t<span>${Loc.getMessage('SIGN_JS_DOCUMENT_STYLE_COLOR')}</span>\n\t\t\t</div>`\n\t\t;\n\t\tUI.updateColorSelectorBtnColor(layout, defaultColorPickerColor);\n\t\tconst updatedColorPickerOptions = {\n\t\t\t...colorPickerOptions,\n\t\t\tbindElement: layout,\n\t\t\tonColorSelected:\n\t\t\t\t(color) => {\n\t\t\t\t\tonColorSelect(color);\n\t\t\t\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\t\t\t},\n\t\t};\n\n\t\tconst picker = new ColorPicker(updatedColorPickerOptions);\n\n\t\tEvent.bind(layout, 'click', () => {\n\t\t\tpicker.open();\n\t\t});\n\n\t\treturn { layout, colorPicker: picker };\n\t}\n\n\tstatic updateColorSelectorBtnColor(layout: HTMLElement, color: string): void\n\t{\n\t\tconst circleColor = layout.querySelector('.sign-document__block-style-btn--color-block');\n\t\tif (Type.isNil(circleColor))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.style(\n\t\t\tcircleColor,\n\t\t\t'background-color',\n\t\t\tcolor,\n\t\t);\n\t}\n}\n","import { Cache, Loc, Tag, Text as TextFormat } from 'main.core';\nimport UI from '../../../../document/src/ui';\nimport Block from './block';\nimport Dummy from './dummy';\n\nexport default class MySign extends Dummy\n{\n\tdataSrc: string;\n\n\t#cache = new Cache.MemoryCache();\n\t#defaultSignatureColor: string = '#0047ab';\n\t#availableSignatureColors: string = ['#000', this.#defaultSignatureColor, '#8b00ff'];\n\t#selectedSignatureColor: string | null = null;\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns true if style panel mast be showed.\n\t * @return {boolean}\n\t */\n\tisStyleAllowed(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): { width: number, height: number }\n\t{\n\t\treturn {\n\t\t\twidth: 200,\n\t\t\theight: 70,\n\t\t};\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tconst { width, height } = this.block.getPosition();\n\n\t\tlet src = null;\n\t\tif (this.dataSrc)\n\t\t{\n\t\t\tsrc = this.dataSrc;\n\t\t}\n\t\telse if (this.data.base64)\n\t\t{\n\t\t\tsrc = 'data:image;base64,' + this.data.base64;\n\t\t}\n\n\t\tif (src)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<img src=\"${src}\" alt=\"\">\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_member-nodata\">\n\t\t\t\t\t${TextFormat.encode(this.data.text || this.getPlaceholderLabel())}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t}\n\n\t/**\n\t * Returns placeholder's label.\n\t * @return {string}\n\t */\n\tgetPlaceholderLabel(): string\n\t{\n\t\treturn Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_MY_SIGN');\n\t}\n\n\t#getSignatureColor(): string\n\t{\n\t\treturn this.#selectedSignatureColor ?? this.#defaultSignatureColor;\n\t}\n\n\tonClickOut()\n\t{\n\t\tsuper.onClickOut();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\tonRemove()\n\t{\n\t\tsuper.onRemove();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\t#closeColorPickerPopup()\n\t{\n\t\tconst { colorPicker } = this.#getColorSelectorBtn();\n\t\tcolorPicker.close();\n\t}\n\n\tonSave()\n\t{\n\t\tsuper.onSave();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\tgetStyles(): { [styleName: string]: string }\n\t{\n\t\treturn { backgroundPosition: 'center !important', color: this.#getSignatureColor() };\n\t}\n\n\tchangeStyleColor(color: string, emitEvent: boolean = true): void\n\t{\n\t\tsuper.changeStyleColor(color);\n\t\tthis.#selectedSignatureColor = color;\n\n\t\tconst { layout, colorPicker } = this.#getColorSelectorBtn();\n\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\tcolorPicker.setSelectedColor(color);\n\n\t\tif (emitEvent)\n\t\t{\n\t\t\tthis.emit(this.events.onColorStyleChange);\n\t\t}\n\t}\n\n\t/**\n\t * @return {HTMLElement | null}\n\t */\n\tgetBlockCaption(): ?HTMLElement\n\t{\n\t\tconst { layout: colorSelectorBtnLayout } = this.#getColorSelectorBtn();\n\n\t\treturn Tag.render`\n\t\t\t<div style=\"display: flex; flex-direction: row;\">\n\t\t\t${colorSelectorBtnLayout}\n\t\t\t<div class=\"sign-document__block-style--separator\"></div>\n\t\t\t<div class=\"sign-document-block-member-wrapper\">\n\t\t\t\t<i>${Loc.getMessage('SIGN_JS_DOCUMENT_SIGN_ACTION_BUTTON')}</i>\n\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#getColorSelectorBtn(): { layout: HTMLElement, colorPicker: BX.ColorPicker }\n\t{\n\t\treturn this.#cache.remember('colorSelectorBtn', () => UI.getColorSelectorBtn(\n\t\t\tthis.#selectedSignatureColor ?? this.#defaultSignatureColor,\n\t\t\t(color) => this.changeStyleColor(color),\n\t\t\t{\n\t\t\t\tcolors: [this.#availableSignatureColors],\n\t\t\t\tallowCustomColor: false,\n\t\t\t\tselectedColor: this.#selectedSignatureColor ?? this.#defaultSignatureColor,\n\t\t\t\tcolorPreview: false,\n\t\t\t},\n\t\t));\n\t}\n}\n","import { Loc, Tag, Text } from 'main.core';\nimport { Api } from 'sign.v2.api';\nimport { Uploader } from 'ui.stamp.uploader';\nimport Dummy from './dummy';\nimport Block from './block';\n\nexport default class MyStamp extends Dummy\n{\n\tstatic currentBlock: Block;\n\n\tdataSrc: string;\n\t#uploader: Uploader;\n\t#api: Api;\n\n\tconstructor(block: Block)\n\t{\n\t\tsuper(block);\n\n\t\tthis.#uploader = new Uploader({\n\t\t\tcontroller: {\n\t\t\t\tupload: 'sign.upload.stampUploadController',\n\t\t\t},\n\t\t\tcontact: {\n\t\t\t\tid: 0,\n\t\t\t\tlabel: 'Admin'\n\t\t\t},\n\t\t});\n\t\tthis.#uploader.subscribe('onSaveAsync', async (event) => {\n\t\t\tMyStamp.currentBlock.await(true);\n\t\t\tconst eventData = event.getData();\n\t\t\tif (!eventData?.file?.serverId)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.dataSrc = eventData.file.serverPreviewUrl;\n\t\t\tthis.#saveStamp(MyStamp.currentBlock, eventData.file.serverId);\n\t\t});\n\t\tthis.#api = new Api();\n\t}\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns true if style panel mast be showed.\n\t * @return {boolean}\n\t */\n\tisStyleAllowed(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 151,\n\t\t\theight: 151\n\t\t};\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement}\n\t */\n\tgetActionButton(): HTMLElement\n\t{\n\t\tconst title = this.data.__view?.base64 ?\n\t\t\tLoc.getMessage('SIGN_EDITOR_BLOCK_CHANGE_STAMP') :\n\t\t\tLoc.getMessage('SIGN_EDITOR_BLOCK_LOAD_STAMP');\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t\t${title}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t * @param {PointerEvent} event\n\t */\n\t#onActionClick(event: PointerEvent)\n\t{\n\t\tMyStamp.currentBlock = this.block;\n\t\tthis.#uploader.show();\n\t}\n\n\t/**\n\t * Saves stamp to backend.\n\t * @param {Block} block\n\t * @param {string} fileId\n\t */\n\tasync #saveStamp(block: Block, fileId: string)\n\t{\n\t\tconst memberPart = block.getMemberPart();\n\t\tconst member = block.blocksManager.getMemberByPart(memberPart);\n\t\tawait this.#api.saveStamp(member.uid, fileId);\n\t\tblock.assign();\n\t\tconst layout = MyStamp.currentBlock.getLayout();\n\t\tconst button = layout.querySelector('button[data-role=\"action\"]');\n\t\tbutton.textContent = Loc.getMessage('SIGN_EDITOR_BLOCK_CHANGE_STAMP');\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tlet src = null;\n\n\t\tif (this.data.__view?.base64)\n\t\t{\n\t\t\tsrc = 'data:image;base64,' + this.data.__view.base64;\n\t\t}\n\n\t\tif (src)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_stamp\" style=\"background-image: url(${src})\"></div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_member-nodata --stamp\"></div>\n\t\t\t`;\n\t\t}\n\t}\n}\n","import { Loc, Tag, Text as TextFormat } from 'main.core';\nimport { Api } from 'sign.v2.api';\n\nimport Dummy from './dummy';\n\nexport default class Number extends Dummy\n{\n\tstatic sliderOnMessageBind: boolean = false;\n\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 100,\n\t\t\theight: 28\n\t\t};\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t * @param {PointerEvent} event\n\t */\n\t#onActionClick(event: PointerEvent)\n\t{\n\t\tevent.stopPropagation();\n\t\tif (!Number.sliderOnMessageBind)\n\t\t{\n\t\t\tNumber.sliderOnMessageBind = true;\n\n\t\t\tBX.addCustomEvent(window, 'SidePanel.Slider:onMessage', async (event) =>\n\t\t\t{\n\t\t\t\tconst isEditor = event.slider?.url === 'editor';\n\t\t\t\tif (isEditor && event.getEventId() === 'numerator-saved-event')\n\t\t\t\t{\n\t\t\t\t\tconst numeratorData = event.getData();\n\t\t\t\t\tconst currentBlock = event?.sender?.options?.data?.block ?? this.block;\n\n\t\t\t\t\tif (numeratorData.type === 'CRM_SMART_DOCUMENT')\n\t\t\t\t\t{\n\t\t\t\t\t\tcurrentBlock.await(true);\n\t\t\t\t\t\tconst api = new Api();\n\t\t\t\t\t\tconst uid = currentBlock.blocksManager.getDocumentUid();\n\t\t\t\t\t\tawait api.refreshEntityNumber(uid);\n\t\t\t\t\t\tcurrentBlock.assign();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tconst { crmNumeratorUrl } = this.data.__view;\n\t\tBX.SidePanel.Instance.open(crmNumeratorUrl, {\n\t\t\twidth: 480,\n\t\t\tcacheable: false,\n\t\t\tdata: {\n\t\t\t\tblock: this.block\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t\t${Loc.getMessage('SIGN_JS_DOCUMENT_NUMBER_ACTION_EDIT')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-number\">\n\t\t\t\t${TextFormat.encode(this.data.text || '').toString()}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Number.defaultTextBlockPaddingStyles };\n\t}\n}\n","import { Cache, Loc, Tag, Text as TextFormat, Type, Dom } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport type { FieldSelectEvent, FieldSelectEventData } from '../types/events/fieldSelectEvent';\nimport Dummy from './dummy';\nimport { Selector } from \"crm.form.fields.selector\";\n\nexport default class Reference extends Dummy\n{\n\t#cache = new Cache.MemoryCache();\n\t#field: string;\n\t#actionButton: HTMLElement;\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.data = data ? data : {};\n\t\tthis.#field = this.data.field ?? '';\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t\tthis.#onActionClick();\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t */\n\t#onActionClick()\n\t{\n\t\tthis.#getCrmFieldSelectorPanel()\n\t\t\t.show()\n\t\t\t.then((selectedNames: Array<string>) => {\n\t\t\t\tconst eventSelectedNames = [...selectedNames];\n\t\t\t\tif (selectedNames.length === 0 && Type.isStringFilled(this.#field))\n\t\t\t\t{\n\t\t\t\t\teventSelectedNames.push(this.#field);\n\t\t\t\t}\n\t\t\t\tthis.#emitOnFieldSelectEvent(eventSelectedNames);\n\n\t\t\t\tif (selectedNames.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tDom.removeClass(this.block.getLayout(), '--invalid');\n\t\t\t\tthis.#field = selectedNames[0];\n\t\t\t\tthis.setData({\n\t\t\t\t\tfield: this.#field,\n\t\t\t\t});\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t}, 0);\n\t\t\t});\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\tif (Type.isUndefined(Selector))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.#actionButton = Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#setActionButtonLabel();\n\n\t\treturn this.#actionButton;\n\t}\n\n\t/**\n\t * Sets label to action button.\n\t */\n\t#setActionButtonLabel()\n\t{\n\t\tif (!this.#actionButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionButton = this.#actionButton.querySelector('button');\n\t\tconst defaultCaption = Loc.getMessage('SIGN_JS_DOCUMENT_REFERENCE_ACTION_BUTTON');\n\t\tif (!this.#field)\n\t\t{\n\t\t\tactionButton.textContent = defaultCaption;\n\t\t\treturn;\n\t\t}\n\n\t\tconst fieldSelector = this.#cache.get('fieldSelector') ?? this.#getCrmFieldSelectorPanel();\n\t\tconst fieldsList = fieldSelector.getFieldsList();\n\t\tconst fields = [\n\t\t\t...fieldsList?.CONTACT?.FIELDS ?? [],\n\t\t\t...fieldsList?.SMART_DOCUMENT?.FIELDS ?? [],\n\t\t];\n\t\tconst field = fields.find((field) => field.name === this.#field);\n\t\tconst caption = field ? field.caption : defaultCaption;\n\t\tactionButton.textContent = caption;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tthis.#setActionButtonLabel();\n\n\t\tconst { width, height } = this.block.getPosition();\n\n\t\tif (this.data.src)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div style=\"width: ${width - 14}px; height: ${height - 14}px; background: url(${this.data.src}) no-repeat top; background-size: cover;\">\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst className = !this.data.text ? 'sign-document__block-content_member-nodata' : '';\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"${className}\">\n\t\t\t\t\t${TextFormat.encode(this.data.text || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA'))}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t}\n\n\t#getCrmFieldSelectorPanel(): Selector\n\t{\n\t\tconst blocksManager = this.block.blocksManager;\n\t\tconst member = blocksManager.getMemberByPart(this.block.getMemberPart());\n\n\t\tconst { presetId } = member;\n\n\t\treturn this.#cache.remember('fieldSelector', () => {\n\t\t\tconst selector = new Selector({\n\t\t\t\tmultiple: false,\n\t\t\t\tcontrollerOptions: {\n\t\t\t\t\thideVirtual: 1,\n\t\t\t\t\thideRequisites: 1,\n\t\t\t\t\thideSmartDocument: 1,\n\t\t\t\t\tpresetId,\n\t\t\t\t},\n\t\t\t\tpresetId,\n\t\t\t\tfilter: {\n\t\t\t\t\t'+categories': [\n\t\t\t\t\t\t'CONTACT',\n\t\t\t\t\t\t'SMART_DOCUMENT',\n\t\t\t\t\t],\n\t\t\t\t\t'+fields': [\n\t\t\t\t\t\t'list',\n\t\t\t\t\t\t'string',\n\t\t\t\t\t\t'date',\n\t\t\t\t\t\t'typed_string',\n\t\t\t\t\t\t'text',\n\t\t\t\t\t\t'datetime',\n\t\t\t\t\t\t'enumeration',\n\t\t\t\t\t\t'address',\n\t\t\t\t\t\t'url',\n\t\t\t\t\t\t'double',\n\t\t\t\t\t\t'integer',\n\t\t\t\t\t],\n\t\t\t\t\t'-fields': [\n\t\t\t\t\t\t({ entity_field_name: fieldName }) => this.#getCrmFieldsNameBlackList().has(fieldName),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\tfieldsFactory: {\n\t\t\t\t\tfilter: this.#filterRequisiteCreateFields.bind(this),\n\t\t\t\t},\n\t\t\t});\n\n\t\t\tselector.subscribe('onSliderCloseComplete', this.#onCrmFieldSelectorSliderCloseComplete.bind(this));\n\n\t\t\treturn selector;\n\t\t});\n\t}\n\n\t#onCrmFieldSelectorSliderCloseComplete(): void\n\t{\n\t\tsetTimeout(() => {\n\t\t\t// event already sended\n\t\t\tif (Type.isStringFilled(this.#field))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#emitOnFieldSelectEvent([]);\n\t\t});\n\t}\n\n\t#emitOnFieldSelectEvent(selectedNames: Array<string>): void\n\t{\n\t\tconst onFieldSelectEventData: FieldSelectEventData = { selectedFieldNames: selectedNames };\n\t\tconst onFieldSelectEvent: FieldSelectEvent = new BaseEvent({ data: onFieldSelectEventData });\n\t\tthis.emit('onFieldSelect', onFieldSelectEvent);\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Reference.defaultTextBlockPaddingStyles };\n\t}\n\n\t#getCrmFieldsNameBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'ADDRESS',\n\t\t\t'REG_ADDRESS',\n\t\t]);\n\t}\n\n\t#getCreateFieldTypeNamesBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'file',\n\t\t\t'employee',\n\t\t\t'boolean',\n\t\t\t'money',\n\t\t]);\n\t}\n\n\t#filterRequisiteCreateFields(fields: Array<{ name: string }>): Array<Object>\n\t{\n\t\treturn fields.filter(\n\t\t\t(createFieldType) => !this.#getCreateFieldTypeNamesBlackList().has(createFieldType.name),\n\t\t);\n\t}\n}\n","import { Cache, Loc, Tag, Text as TextFormat, Type, Dom } from 'main.core';\nimport { BaseEvent } from 'main.core.events';\nimport type { FieldSelectEvent, FieldSelectEventData } from '../types/events/fieldSelectEvent';\nimport Dummy from './dummy';\nimport { Selector } from 'crm.form.fields.selector';\n\nexport default class MyReference extends Dummy\n{\n\t#field: string;\n\t#actionButton: HTMLElement;\n\t#cache = new Cache.MemoryCache();\n\n\t/**\n\t * Sets new data.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.data = data ? data : {};\n\t\tthis.#field = this.data.field ?? '';\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t\tthis.#onActionClick();\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t */\n\t#onActionClick()\n\t{\n\t\tthis.#getCrmFieldSelectorPanel()\n\t\t\t.show()\n\t\t\t.then((selectedNames: Array<string>): void => {\n\t\t\t\tconst eventSelectedNames = [...selectedNames];\n\t\t\t\tif (selectedNames.length === 0 && Type.isStringFilled(this.#field))\n\t\t\t\t{\n\t\t\t\t\teventSelectedNames.push(this.#field);\n\t\t\t\t}\n\t\t\t\tthis.#emitOnFieldSelectEvent(eventSelectedNames);\n\n\t\t\t\tif (selectedNames.length === 0)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tDom.removeClass(this.block.getLayout(), '--invalid');\n\t\t\t\tthis.#field = selectedNames[0];\n\t\t\t\tthis.setData({\n\t\t\t\t\tfield: this.#field,\n\t\t\t\t});\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t}, 0);\n\t\t\t});\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement | null}\n\t */\n\tgetActionButton(): ?HTMLElement\n\t{\n\t\tif (Type.isUndefined(Selector))\n\t\t{\n\t\t\treturn null;\n\t\t}\n\n\t\tthis.#actionButton = Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\">\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\n\t\tthis.#setActionButtonLabel();\n\n\t\treturn this.#actionButton;\n\t}\n\n\t/**\n\t * Sets label to action button.\n\t */\n\t#setActionButtonLabel()\n\t{\n\t\tif (!this.#actionButton)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst actionButton = this.#actionButton.querySelector('button');\n\t\tconst defaultCaption = Loc.getMessage('SIGN_JS_DOCUMENT_REFERENCE_ACTION_BUTTON');\n\t\tif (!this.#field)\n\t\t{\n\t\t\tactionButton.textContent = defaultCaption;\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst fieldSelector = this.#getCrmFieldSelectorPanel();\n\t\tconst fieldsList = fieldSelector.getFieldsList();\n\t\tconst fields = [\n\t\t\t...fieldsList?.COMPANY?.FIELDS ?? [],\n\t\t\t...fieldsList?.SMART_DOCUMENT?.FIELDS ?? [],\n\t\t];\n\t\tconst field = fields.find((field) => field.name === this.#field);\n\t\tconst caption = field ? field.caption : defaultCaption;\n\t\tactionButton.textContent = caption;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tthis.#setActionButtonLabel();\n\n\t\tconst { width, height } = this.block.getPosition();\n\n\t\tif (this.data.src)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div style=\"width: ${width - 14}px; height: ${height - 14}px; background: url(${this.data.src}) no-repeat top; background-size: cover;\">\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t\tconst className = !this.data.text ? 'sign-document__block-content_member-nodata' : '';\n\n\t\treturn Tag.render`\n\t\t\t\t<div class=\"${className}\">\n\t\t\t\t\t${TextFormat.encode(this.data.text || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_MY_BLOCKS'))}\n\t\t\t\t</div>\n\t\t\t`;\n\t}\n\n\t#getCrmFieldSelectorPanel(): Selector\n\t{\n\t\tconst blocksManager = this.block.blocksManager;\n\t\tconst member = blocksManager.getMemberByPart(this.block.getMemberPart());\n\t\tconst { presetId } = member;\n\n\t\treturn this.#cache.remember('fieldSelector', () => {\n\t\t\tconst selector = new Selector({\n\t\t\t\tmultiple: false,\n\t\t\t\tcontrollerOptions: {\n\t\t\t\t\thideVirtual: 1,\n\t\t\t\t\thideRequisites: 1,\n\t\t\t\t\thideSmartDocument: 1,\n\t\t\t\t\tpresetId,\n\t\t\t\t},\n\t\t\t\tpresetId,\n\t\t\t\tfilter: {\n\t\t\t\t\t'+categories': [\n\t\t\t\t\t\t'COMPANY',\n\t\t\t\t\t\t'SMART_DOCUMENT',\n\t\t\t\t\t],\n\t\t\t\t\t'+fields': [\n\t\t\t\t\t\t'list',\n\t\t\t\t\t\t'string',\n\t\t\t\t\t\t'date',\n\t\t\t\t\t\t'typed_string',\n\t\t\t\t\t\t'text',\n\t\t\t\t\t\t'datetime',\n\t\t\t\t\t\t'enumeration',\n\t\t\t\t\t\t'address',\n\t\t\t\t\t\t'url',\n\t\t\t\t\t\t'double',\n\t\t\t\t\t\t'integer',\n\t\t\t\t\t],\n\t\t\t\t\t'-fields': [\n\t\t\t\t\t\tthis.#getFieldNegativeFilter(),\n\t\t\t\t\t\t({ entity_field_name: fieldName }) => this.#getCrmFieldsNameBlackList().has(fieldName),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\tfieldsFactory: {\n\t\t\t\t\tfilter: this.#filterRequisiteCreateFields.bind(this),\n\t\t\t\t},\n\t\t\t});\n\t\t\tselector.subscribe('onSliderCloseComplete', this.#onCrmFieldSelectorSliderCloseComplete.bind(this));\n\n\t\t\treturn selector;\n\t\t});\n\t}\n\n\t#onCrmFieldSelectorSliderCloseComplete(): void\n\t{\n\t\tsetTimeout(() => {\n\t\t\t// event already sended\n\t\t\tif (Type.isStringFilled(this.#field))\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.#emitOnFieldSelectEvent([]);\n\t\t});\n\t}\n\n\t#getFieldNegativeFilter(): (Object) => boolean\n\t{\n\t\tconst blackList = this.#getFieldsNameBlackList();\n\n\t\treturn (field) => {\n\t\t\treturn blackList.includes(field.name);\n\t\t};\n\t}\n\n\t#getFieldsNameBlackList(): Array<string>\n\t{\n\t\treturn [\n\t\t\t'COMPANY_LINK',\n\t\t\t'COMPANY_REG_ADDRESS',\n\t\t\t'COMPANY_ORIGIN_VERSION',\n\t\t];\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...MyReference.defaultTextBlockPaddingStyles };\n\t}\n\n\t#emitOnFieldSelectEvent(selectedNames: Array<string>): void\n\t{\n\t\tconst onFieldSelectEventData: FieldSelectEventData = { selectedFieldNames: selectedNames };\n\t\tconst onFieldSelectEvent: FieldSelectEvent = new BaseEvent({ data: onFieldSelectEventData });\n\t\tthis.emit('onFieldSelect', onFieldSelectEvent);\n\t}\n\n\t#getCrmFieldsNameBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'ADDRESS',\n\t\t\t'REG_ADDRESS',\n\t\t]);\n\t}\n\n\t#getCreateFieldTypeNamesBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'file',\n\t\t\t'employee',\n\t\t\t'boolean',\n\t\t\t'money',\n\t\t]);\n\t}\n\n\t#filterRequisiteCreateFields(fields: Array<{ name: string }>): Array<Object>\n\t{\n\t\treturn fields.filter(\n\t\t\t(createFieldType) => !this.#getCreateFieldTypeNamesBlackList().has(createFieldType.name),\n\t\t);\n\t}\n}\n","import { FieldsetViewer } from 'crm.requisite.fieldset-viewer';\nimport { Loc, Tag, Text as TextFormat } from 'main.core';\n\nimport Dummy from './dummy';\n\nexport default class Requisites extends Dummy\n{\n\t/**\n\t * Returns true if block is in singleton mode.\n\t * @return {boolean}\n\t */\n\tisSingleton(): boolean\n\t{\n\t\treturn true;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): { width: number, height: number }\n\t{\n\t\treturn {\n\t\t\twidth: 250,\n\t\t\theight: 220,\n\t\t};\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t * @param {PointerEvent} event\n\t */\n\t#onActionClick(event: PointerEvent)\n\t{\n\t\tconst blocksManager = this.block.blocksManager;\n\t\tconst config = blocksManager.getConfig();\n\t\tconst member = blocksManager.getMemberByPart(this.block.getMemberPart());\n\n\t\tevent.stopPropagation();\n\n\t\tif (!member)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { cid, entityTypeId, presetId } = member;\n\t\t(new FieldsetViewer({\n\t\t\tentityTypeId,\n\t\t\tentityId: cid,\n\t\t\tevents: {\n\t\t\t\tonClose: () => {\n\t\t\t\t\tthis.block.assign();\n\t\t\t\t},\n\t\t\t},\n\t\t\tfieldListEditorOptions: {\n\t\t\t\tfieldsPanelOptions: {\n\t\t\t\t\tfilter: {\n\t\t\t\t\t\t'+categories': [\n\t\t\t\t\t\t\t'CONTACT',\n\t\t\t\t\t\t],\n\t\t\t\t\t\t'+fields': [\n\t\t\t\t\t\t\t'list',\n\t\t\t\t\t\t\t'string',\n\t\t\t\t\t\t\t'date',\n\t\t\t\t\t\t\t'typed_string',\n\t\t\t\t\t\t\t'text',\n\t\t\t\t\t\t\t'datetime',\n\t\t\t\t\t\t\t'enumeration',\n\t\t\t\t\t\t\t'address',\n\t\t\t\t\t\t\t'url',\n\t\t\t\t\t\t\t'double',\n\t\t\t\t\t\t\t'integer',\n\t\t\t\t\t\t],\n\t\t\t\t\t\t'-fields': [\n\t\t\t\t\t\t\t({ entity_field_name: fieldName }) => this.#getCrmFieldsNameBlackList().has(fieldName),\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t\tfieldsFactory: {\n\t\t\t\t\t\tfilter: this.#filterRequisiteCreateFields.bind(this),\n\t\t\t\t\t},\n\t\t\t\t\tpresetId,\n\t\t\t\t\tcontrollerOptions: {\n\t\t\t\t\t\thideVirtual: 1,\n\t\t\t\t\t\thideRequisites: 0,\n\t\t\t\t\t\thideSmartDocument: 1,\n\t\t\t\t\t\tpresetId,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t}))\n\t\t\t.show()\n\t\t;\n\t}\n\n\t/**\n\t * Returns action button for edit content.\n\t * @return {HTMLElement}\n\t */\n\tgetActionButton(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style-btn --funnel\">\n\t\t\t\t<button onclick=\"${this.#onActionClick.bind(this)}\" data-role=\"action\" data-id=\"action-${this.block.getCode()}\">\n\t\t\t\t\t${Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_ACTION_BUTTON')}\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tconst text = this.data.text || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_REQUISITES');\n\t\tconst tagBody = this.data.text ? '' : ' class=\"sign-document__block-content_member-nodata\"';\n\n\t\treturn Tag.render`\n\t\t\t<div${tagBody}>\n\t\t\t\t${TextFormat.encode(text).toString().replaceAll('[br]', '<br>')}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Requisites.defaultTextBlockPaddingStyles };\n\t}\n\n\t#getCrmFieldsNameBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'ADDRESS',\n\t\t\t'REG_ADDRESS',\n\t\t]);\n\t}\n\n\t#getCreateFieldTypeNamesBlackList(): Set<string>\n\t{\n\t\treturn new Set([\n\t\t\t'file',\n\t\t\t'employee',\n\t\t\t'boolean',\n\t\t\t'money',\n\t\t]);\n\t}\n\n\t#filterRequisiteCreateFields(fields: Array<{ name: string }>): Array<Object>\n\t{\n\t\treturn fields.filter(\n\t\t\t(createFieldType) => !this.#getCreateFieldTypeNamesBlackList().has(createFieldType.name),\n\t\t);\n\t}\n}\n","import { Loc, Tag, Text as TextFormat } from 'main.core';\nimport Dummy from './dummy';\n\nexport default class Stamp extends Dummy\n{\n\t/**\n\t * Returns true if style panel mast be showed.\n\t * @return {boolean}\n\t */\n\tisStyleAllowed(): boolean\n\t{\n\t\treturn false;\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): {width: number, height: number}\n\t{\n\t\treturn {\n\t\t\twidth: 151,\n\t\t\theight: 151\n\t\t};\n\t}\n\n\t/**\n\t * Returns placeholder's label.\n\t * @return {string}\n\t */\n\tgetPlaceholderLabel(): string\n\t{\n\t\treturn Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_STAMP');\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\tconst {width, height} = this.block.getPosition();\n\n\t\tif (this.data.base64)\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_stamp\" style=\"background-image: url(${src})\"></div>\n\t\t\t`;\n\t\t}\n\t\telse\n\t\t{\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-document__block-content_member-nodata\">\n\t\t\t\t\t\n\t\t\t\t</div>\n\t\t\t`;\n\t\t}\n\t}\n}\n","import { Cache, Loc, Tag, Text as TextFormat } from 'main.core';\nimport UI from '../../../../document/src/ui';\nimport Stamp from './stamp';\n\nexport default class Sign extends Stamp\n{\n\t#cache = new Cache.MemoryCache();\n\t#defaultSignatureColor: string = '#0047ab';\n\t#availableSignatureColors: string = ['#000', this.#defaultSignatureColor, '#8b00ff'];\n\t#selectedSignatureColor: string | null = null;\n\n\t/**\n\t * Returns placeholder's label.\n\t * @return {string}\n\t */\n\tgetPlaceholderLabel(): string\n\t{\n\t\treturn Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NO_DATA_SIGN');\n\t}\n\n\t/**\n\t * Returns initial dimension of block.\n\t * @return {width: number, height: number}\n\t */\n\tgetInitDimension(): { width: number, height: number }\n\t{\n\t\treturn {\n\t\t\twidth: 200,\n\t\t\theight: 70,\n\t\t};\n\t}\n\n\tgetBlockCaption(): ?HTMLElement\n\t{\n\t\tconst { layout: colorSelectorBtnLayout } = this.#getColorSelectorBtn();\n\n\t\treturn Tag.render`\n\t\t\t<div style=\"display: flex; flex-direction: row;\">\n\t\t\t${colorSelectorBtnLayout}\n\t\t\t<div class=\"sign-document__block-style--separator\"></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement | string}\n\t */\n\tgetViewContent(): HTMLElement | string\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-content_member-nodata\">\n\t\t\t\t${TextFormat.encode(this.getPlaceholderLabel())}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tgetStyles(): { [styleName: string]: string }\n\t{\n\t\treturn { backgroundPosition: 'center !important', color: this.#getSignatureColor() };\n\t}\n\n\tupdateColor(color: string)\n\t{\n\t\tsuper.updateColor(color);\n\t\tconst { layout, colorPicker } = this.#getColorSelectorBtn();\n\t\tthis.#selectedSignatureColor = color;\n\n\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\tcolorPicker.setSelectedColor(color);\n\t}\n\n\tchangeStyleColor(color: string, emitEvent: boolean = true): void\n\t{\n\t\tsuper.changeStyleColor(color);\n\t\tthis.#selectedSignatureColor = color;\n\n\t\tconst { layout, colorPicker } = this.#getColorSelectorBtn();\n\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\tcolorPicker.setSelectedColor(color);\n\n\t\tif (emitEvent)\n\t\t{\n\t\t\tthis.emit(this.events.onColorStyleChange);\n\t\t}\n\t}\n\n\t#getColorSelectorBtn(): { layout: HTMLElement, colorPicker: BX.ColorPicker }\n\t{\n\t\treturn this.#cache.remember('colorSelectorBtn', () => UI.getColorSelectorBtn(\n\t\t\tthis.#selectedSignatureColor ?? this.#defaultSignatureColor,\n\t\t\t(color) => this.changeStyleColor(color),\n\t\t\t{\n\t\t\t\tcolors: [this.#availableSignatureColors],\n\t\t\t\tallowCustomColor: false,\n\t\t\t\tselectedColor: this.#selectedSignatureColor ?? this.#defaultSignatureColor,\n\t\t\t\tcolorPreview: false,\n\t\t\t},\n\t\t));\n\t}\n\n\t#getSignatureColor(): string\n\t{\n\t\treturn this.#selectedSignatureColor ?? this.#defaultSignatureColor;\n\t}\n\n\tonSave()\n\t{\n\t\tsuper.onSave();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\tonRemove()\n\t{\n\t\tsuper.onRemove();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\tonClickOut()\n\t{\n\t\tsuper.onClickOut();\n\t\tthis.#closeColorPickerPopup();\n\t}\n\n\t#closeColorPickerPopup()\n\t{\n\t\tconst { colorPicker } = this.#getColorSelectorBtn();\n\t\tcolorPicker.close();\n\t}\n}\n","import { Event, Loc, Tag, Text as TextFormat } from 'main.core';\nimport Dummy from './dummy';\nimport Block from './block';\n\nexport default class Text extends Dummy\n{\n\t#textContainer: HTMLElement;\n\n\tconstructor(block: Block)\n\t{\n\t\tsuper(block);\n\t\tthis.setEventNamespace('BX.Sign.V2.Blocks.Text');\n\t}\n\n\t/**\n\t * Calls when action button was clicked.\n\t */\n\tonActionClick()\n\t{\n\t\tthis.#textContainer.contentEditable = true;\n\t\tthis.#textContainer.focus();\n\t}\n\n\t/**\n\t * Calls when typing in text container.\n\t */\n\t#onKeyUp(event): void\n\t{\n\t\tthis.setText(this.#textContainer.innerText.replaceAll(\"\\n\", '[br]'));\n\t\tthis.onChange();\n\t}\n\n\tgetText(): string\n\t{\n\t\treturn this.data.text;\n\t}\n\n\tgetContainer(): HTMLElement\n\t{\n\t\treturn this.#textContainer;\n\t}\n\n\t/**\n\t * Returns type's content in view mode.\n\t * @return {HTMLElement}\n\t */\n\tgetViewContent(): HTMLElement\n\t{\n\t\tconst content = this.data.text === Loc.getMessage('SIGN_JS_DOCUMENT_TEXT_PLACEHOLDER')\n\t\t\t? ''\n\t\t\t: this.data.text\n\t\t;\n\n\t\tthis.#textContainer = Tag.render`\n\t\t\t<div class=\"sign-document-block-text\" placeholder=\"${Loc.getMessage('SIGN_JS_DOCUMENT_TEXT_PLACEHOLDER')}\">\n\t\t\t\t${TextFormat.encode(content).replaceAll('[br]', '<br>')}\n\t\t\t</div>\n\t\t`;\n\n\t\tEvent.bind(this.#textContainer, 'keyup', this.#onKeyUp.bind(this));\n\t\tEvent.bind(this.#textContainer, 'paste', event => setTimeout(this.#onPaste.bind(this, event)));\n\n\t\treturn this.#textContainer;\n\t}\n\n\t#onPaste(event: ClipboardEvent): void\n\t{\n\t\tthis.#textContainer.innerHTML = this.#textContainer.innerText.replaceAll('\\n', '<br>');\n\n\t\tconst range = document.createRange();\n\t\trange.selectNodeContents(this.#textContainer);\n\t\trange.collapse(false)\n\n\t\tconst selection = document.getSelection();\n\t\tselection.removeAllRanges();\n\t\tselection.addRange(range);\n\n\t\tthis.setText(\n\t\t\tthis.#textContainer\n\t\t\t\t.innerHTML\n\t\t\t\t.replaceAll('<br>', '[br]'),\n\t\t);\n\t\tthis.onChange();\n\t}\n\n\tgetStyles(): { [p: string]: string }\n\t{\n\t\treturn { ...super.getStyles(), ...Text.defaultTextBlockPaddingStyles };\n\t}\n}","import { Dom, Event, Loc, Tag, Text as TextFormat, Reflection, Type } from 'main.core';\nimport { UI as SignUI } from 'sign.ui';\nimport { ColorPickerOptions } from '../../../../document/src/ui';\nimport { MemberItem } from '../types/document';\nimport '../style.css';\nimport 'color_picker';\n\ntype BlockLayoutOptions = {\n\tonRemove: () => {},\n\tonSave: () => {}\n};\n\nconst ColorPicker = Reflection.getClass('BX.ColorPicker');\n\nexport default class UI\n{\n\t/**\n\t * Sets width/height/top/left to element.\n\t * @param {HTMLElement} element\n\t * @param {{[key: string]: number}} rect\n\t */\n\tstatic setRect(element: HTMLElement, rect: {[key: string]: number})\n\t{\n\t\tObject.keys(rect).map(key => {\n\t\t\trect[key] = parseInt(rect[key]) + 'px';\n\t\t});\n\t\tDom.style(element, rect);\n\t}\n\n\t/**\n\t * Returns block's layout.\n\t * @param {BlockLayoutOptions} options Layout options.\n\t * @return {HTMLElement}\n\t */\n\tstatic getBlockLayout(options: BlockLayoutOptions): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-wrapper\">\n\t\t\t\t<div class=\"sign-document__block-panel--wrapper\" data-role=\"sign-block__actions\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-document__block-content\">\n\t\t\t\t</div>\n\t\t\t\t<div class=\"sign-document__block-actions\">\n\t\t\t\t\t<div class=\"sign-document__block-actions--wrapper\">\n\t\t\t\t\t\t<button class=\"sign-document__block-actions-btn --remove sign-block-action-remove\" data-role=\"removeAction\" onclick=\"${options.onRemove}\"></button>\n\t\t\t\t\t\t<button class=\"sign-document__block-actions-btn --save sign-block-action-save\" data-role=\"saveAction\" onclick=\"${options.onSave}\"></button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns member selector for block.\n\t * @param {Array<MemberItem>} members All document's members.\n\t * @param {number} selectedValue Selected member.\n\t * @param {() => {}} onChange Handler on change value.\n\t * @return {HTMLElement}\n\t */\n\tstatic getMemberSelector(members: Array<MemberItem>, selectedValue: number,  onChange: () => {}): HTMLElement\n\t{\n\t\tconst menuItems = {};\n\t\tlet selectedName = Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET');\n\n\t\tmembers.map(member => {\n\t\t\tmember.name = member.name || Loc.getMessage('SIGN_JS_DOCUMENT_MEMBER_NAME_NOT_SET');\n\t\t\tmenuItems[member.part] = member.name;\n\n\t\t\tif (member.part === selectedValue)\n\t\t\t{\n\t\t\t\tselectedName = member.name;\n\t\t\t}\n\t\t});\n\n\t\tconst memberSelector = (members.length > 1)\n\t\t\t? Tag.render`<span>${TextFormat.encode(selectedName)}</span>`\n\t\t\t: Tag.render`<i>${TextFormat.encode(selectedName)}</i>`;\n\n\t\tif (members.length > 1)\n\t\t{\n\t\t\tSignUI.bindSimpleMenu({\n\t\t\t\tbindElement: memberSelector,\n\t\t\t\titems: menuItems,\n\t\t\t\tactionHandler: value => {\n\t\t\t\t\tmemberSelector.innerHTML = menuItems[value];\n\t\t\t\t\tonChange(parseInt(value));\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document-block-member-wrapper\">\n\t\t\t\t${memberSelector}\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns resizing area's layout.\n\t * @return {HTMLElement}\n\t */\n\tstatic getResizeArea(): HTMLElement\n\t{\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__resize-area\">\n\t\t\t\t<div class=\"sign-area-resizable-controls\">\n\t\t\t\t\t<span class=\"sign-document__move-control\"></span>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-top\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --right-top\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-right\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --right-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --left-bottom\"></div>\n\t\t\t\t\t<div class=\"sign-document__resize-control --middle-left\"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Returns style panel layout.\n\t * @return {HTMLElement}\n\t */\n\tstatic getStylePanel(\n\t\tactionHandler: (actionName: string, actionValue: string) => {},\n\t\tcollectStyles: {[key: string]: string}\n\t): HTMLElement\n\t{\n\t\t// font family selector\n\t\tconst fonts = {\n\t\t\t'\"Times New Roman\", Times':   '<span style=\"font-family: \\'Times New Roman\\', Times\">Times New Roman</span>',\n\t\t\t'\"Courier New\"':              '<span style=\"font-family: \\'Courier New\\'\">Courier New</span>',\n\t\t\t'Arial, Helvetica':           '<span style=\"font-family: Arial, Helvetica\">Arial / Helvetica</span>',\n\t\t\t'\"Arial Black\", Gadget':      '<span style=\"font-family: \\'Arial Black\\', Gadget\">Arial Black</span>',\n\t\t\t'Tahoma, Geneva':             '<span style=\"font-family: Tahoma, Geneva\">Tahoma / Geneva</span>',\n\t\t\t'Verdana':                    '<span style=\"font-family: Verdana\">Verdana</span>',\n\t\t\t'Georgia, serif':             '<span style=\"font-family: Georgia, serif\">Georgia</span>',\n\t\t\t'monospace':                  '<span style=\"font-family: monospace\">monospace</span>',\n\t\t};\n\t\tconst fontFamily = Tag.render`<div class=\"sign-document__block-style-btn --btn-font-family\">${fonts[collectStyles['fontFamily']] || 'Font'}</div>`;\n\t\tSignUI.bindSimpleMenu({\n\t\t\tbindElement: fontFamily,\n\t\t\titems: fonts,\n\t\t\tactionHandler: value => {\n\t\t\t\tfontFamily.innerHTML = fonts[value];\n\t\t\t\tactionHandler('family', value);\n\t\t\t}\n\t\t});\n\n\t\t// font size selector\n\n\t\tlet fontSizereal = parseInt(collectStyles['fontSize']);\n\t\tlet fontSizeValue = 14;\n\n\t\tif (fontSizereal)\n\t\t{\n\t\t\tfontSizeValue = fontSizereal;\n\t\t}\n\n\t\tconst fontSize = Tag.render`<div class=\"sign-document__block-style-btn --btn-fontsize\">${fontSizeValue+ 'px' || '<i></i>'}</div>`;\n\t\tSignUI.bindSimpleMenu({\n\t\t\tbindElement: fontSize,\n\t\t\titems: [\n\t\t\t\t'6px', '7px', '8px', '9px', '10px', '11px', '12px', '13px', '14px', '15px', '16px',\n\t\t\t\t'18px', '20px', '22px', '24px', '26px', '28px', '36px', '48px', '72px'\n\t\t\t],\n\t\t\tactionHandler: value => {\n\t\t\t\tfontSize.innerHTML = parseInt(value) + 'px';\n\t\t\t\tactionHandler('size', value);\n\t\t\t},\n\t\t\tcurrentValue: fontSizeValue\n\t\t});\n\n\t\tconst { layout: fontColor } = UI.getColorSelectorBtn(\n\t\t\tcollectStyles.color ?? '#000',\n\t\t\t(color) => actionHandler('color', color),\n\t\t);\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-document__block-style--panel\">\n<!--\t\t\t\t<div class=\"sign-document__block-style&#45;&#45;move-control\"></div>-->\n\t\t\t\t${fontFamily}\n\t\t\t\t${fontSize}\n\t\t\t\t${fontColor}\n\t\t\t\t<div class=\"sign-document__block-style--separator\"></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-bold\" data-action=\"bold\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-italic\" data-action=\"italic\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-underline\" data-action=\"underline\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-strike\" data-action=\"through\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-left\" data-action=\"left\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-center\" data-action=\"center\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-right\" data-action=\"right\"><i></i></div>\n\t\t\t\t<div class=\"sign-document__block-style-btn --btn-align-justify\" data-action=\"justify\"><i></i></div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\tstatic getColorSelectorBtn(\n\t\tdefaultColorPickerColor: string,\n\t\tonColorSelect: (string) => any,\n\t\tcolorPickerOptions: ColorPickerOptions = {},\n\t): { layout: HTMLElement, colorPicker: BX.ColorPicker }\n\t{\n\t\tconst layout = Tag.render`<div class=\"sign-document__block-style-btn --btn-color\">\n\t\t\t\t<span class=\"sign-document__block-style-btn--color-block\"></span> \n\t\t\t\t<span>${Loc.getMessage('SIGN_JS_DOCUMENT_STYLE_COLOR')}</span>\n\t\t\t</div>`\n\t\t;\n\t\tUI.updateColorSelectorBtnColor(layout, defaultColorPickerColor);\n\t\tconst updatedColorPickerOptions = {\n\t\t\t...colorPickerOptions,\n\t\t\tbindElement: layout,\n\t\t\tonColorSelected:\n\t\t\t\t(color) => {\n\t\t\t\t\tonColorSelect(color);\n\t\t\t\t\tUI.updateColorSelectorBtnColor(layout, color);\n\t\t\t\t},\n\t\t};\n\n\t\tconst picker = new ColorPicker(updatedColorPickerOptions);\n\n\t\tEvent.bind(layout, 'click', () => {\n\t\t\tpicker.open();\n\t\t});\n\n\t\treturn { layout, colorPicker: picker };\n\t}\n\n\tstatic updateColorSelectorBtnColor(layout: HTMLElement, color: string): void\n\t{\n\t\tconst circleColor = layout.querySelector('.sign-document__block-style-btn--color-block');\n\t\tif (Type.isNil(circleColor))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tDom.style(\n\t\t\tcircleColor,\n\t\t\t'background-color',\n\t\t\tcolor,\n\t\t);\n\t}\n}\n","import { Dom, Event } from 'main.core';\nimport Block from './block';\nimport UI from './ui';\n\ntype StyleOptions = {\n\tblock: Block,\n\tdata: {[key: string]: string}\n};\n\nexport default class Style\n{\n\t#block: Block;\n\n\t#buttons = {\n\t\tfamily: {\n\t\t\tproperty: 'fontFamily',\n\t\t\tvalue: null\n\t\t},\n\t\tsize: {\n\t\t\tproperty: 'fontSize',\n\t\t\tvalue: 14\n\t\t},\n\t\tcolor: {\n\t\t\tproperty: 'color',\n\t\t\tvalue: null\n\t\t},\n\t\tbold: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'fontWeight',\n\t\t\tvalue: 'bold',\n\t\t\tstate: false\n\t\t},\n\t\titalic: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'fontStyle',\n\t\t\tvalue: 'italic',\n\t\t\tstate: false\n\t\t},\n\t\tunderline: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textDecoration',\n\t\t\tvalue: 'underline',\n\t\t\tstate: false\n\t\t},\n\t\tthrough: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textDecoration',\n\t\t\tvalue: 'line-through',\n\t\t\tstate: false\n\t\t},\n\t\tleft: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textAlign',\n\t\t\tvalue: 'left',\n\t\t\tstate: false,\n\t\t\tgroup: 'align'\n\t\t},\n\t\tcenter: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textAlign',\n\t\t\tvalue: 'center',\n\t\t\tstate: false,\n\t\t\tgroup: 'align'\n\t\t},\n\t\tright: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textAlign',\n\t\t\tvalue: 'right',\n\t\t\tstate: false,\n\t\t\tgroup: 'align'\n\t\t},\n\t\tjustify: {\n\t\t\tbutton: null,\n\t\t\tproperty: 'textAlign',\n\t\t\tvalue: 'justify',\n\t\t\tstate: false,\n\t\t\tgroup: 'align'\n\t\t}\n\t};\n\n\t#style = {\n\t\tbuttonPressed: 'sign-document__block-style--button-pressed'\n\t};\n\n\t/**\n\t * Constructor.\n\t * @param {StyleOptions} options\n\t */\n\tconstructor(options: StyleOptions)\n\t{\n\t\tthis.#block = options.block;\n\n\t\tif (options.data)\n\t\t{\n\t\t\tthis.#applyData(options.data);\n\t\t}\n\t}\n\n\t/**\n\t * Handle on panel button click.\n\t * @param {string} code\n\t */\n\t#onPressButton(code: string)\n\t{\n\t\tthis.#buttons[code]['state'] = !this.#buttons[code]['state'];\n\n\t\tif (this.#buttons[code]['state'])\n\t\t{\n\t\t\tDom.addClass(this.#buttons[code]['button'], this.#style.buttonPressed);\n\n\t\t\tif (this.#buttons[code]['group'])\n\t\t\t{\n\t\t\t\tconst group = this.#buttons[code]['group'];\n\n\t\t\t\t[...Object.keys(this.#buttons)].map(key => {\n\t\t\t\t\tif (key !== code && this.#buttons[key]['group'] === group)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#buttons[key]['state'] = false;\n\t\t\t\t\t\tDom.removeClass(this.#buttons[key]['button'], this.#style.buttonPressed);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\tDom.removeClass(this.#buttons[code]['button'], this.#style.buttonPressed);\n\t\t}\n\n\t\tthis.#block.renderStyle();\n\t}\n\n\t/**\n\t * Applies initiated data to current state.\n\t * @param {{[key: string]: string}} data\n\t */\n\t#applyData(data: {[key: string]: string})\n\t{\n\t\t[...Object.keys(this.#buttons)].map(key => {\n\t\t\tconst property = this.#buttons[key]['property'];\n\n\t\t\tif (data[property])\n\t\t\t{\n\t\t\t\tif (typeof this.#buttons[key]['state'] !== 'undefined')\n\t\t\t\t{\n\t\t\t\t\tif (data[property].indexOf(this.#buttons[key]['value']) !== -1)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#buttons[key]['state'] = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.#buttons[key]['value'] = data[property];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Applies collected styles to the element.\n\t * @param {HTMLElement} element\n\t */\n\tapplyStyles(element: HTMLElement)\n\t{\n\t\telement.removeAttribute('style');\n\t\tDom.style(element, this.collectStyles());\n\t}\n\n\tupdateFontSize(fontSize)\n\t{\n\t\tif (fontSize)\n\t\t{\n\t\t\tthis.#buttons.size['property'] = 'fontSize';\n\t\t\tthis.#buttons.size['value'] = fontSize;\n\t\t}\n\t}\n\n\t/**\n\t * Collects checked styles in one dataset.\n\t * @return {{[key: string]: string}}\n\t */\n\tcollectStyles(): {[key: string]: string}\n\t{\n\t\tconst styles = {};\n\n\t\t[...Object.keys(this.#buttons)].map(key => {\n\t\t\tif (this.#buttons[key]['state'] || (typeof this.#buttons[key]['state'] === 'undefined'))\n\t\t\t{\n\t\t\t\tconst property = this.#buttons[key]['property'];\n\t\t\t\tconst value = this.#buttons[key]['value'];\n\n\t\t\t\tif (value === null)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.#buttons[key]['group'])\n\t\t\t\t{\n\t\t\t\t\tstyles[property] = value;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tstyles[property] = (styles[property] ? styles[property] + ' ' : '') + value;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn styles;\n\t}\n\n\t/**\n\t * Returns style panel layout.\n\t * @return {HTMLElement}\n\t */\n\tgetLayout(): HTMLElement\n\t{\n\t\tconst layout = UI.getStylePanel(\n\t\t\t(code: string, value: string) => {\n\t\t\t\tthis.#buttons[code]['value'] = value;\n\t\t\t\tthis.#block.renderStyle();\n\t\t\t},\n\t\t\tthis.collectStyles()\n\t\t);\n\n\t\t[...layout.querySelectorAll('[data-action]')].map(button => {\n\t\t\t\tconst action = button.getAttribute('data-action');\n\n\t\t\tif (this.#buttons[action])\n\t\t\t{\n\t\t\t\tEvent.bind(button, 'click', () => this.#onPressButton(action));\n\t\t\t\tthis.#buttons[action]['button'] = button;\n\n\t\t\t\tif (this.#buttons[action]['state'])\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(this.#buttons[action]['button'], this.#style.buttonPressed);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\treturn layout;\n\t}\n\n\tupdateColor(color: string): void\n\t{\n\t\tthis.#buttons.color.value = color;\n\t}\n}\n","import { Dom, Event, Type } from 'main.core';\nimport { Backend } from 'sign.backend';\nimport { EventEmitter } from 'main.core.events';\nimport { Api } from 'sign.v2.api';\nimport type { FieldSelectEvent } from '../types/events/fieldSelectEvent';\nimport { Date, Dummy, MyRequisites, MySign, MyStamp, Number, Reference, Requisites, Sign, Stamp, Text, MyReference } from './index';\nimport { BlocksManager } from './blocksManager';\nimport Style from './style';\nimport { PositionType, BlockOptions } from '../types/block';\nimport UI from './ui';\n\nexport default class Block extends EventEmitter\n{\n\tevents = {\n\t\tonColorStyleChange: 'onColorStyleChange',\n\t};\n\n\t#id: number;\n\t#code: string;\n\t#layout: HTMLElement;\n\t#stylePanel: Style;\n\t#content: Dummy = null;\n\tblocksManager: BlocksManager;\n\t#memberPart: number = 2;\n\t#panelCreated: boolean = false;\n\t#allowMembers: boolean = false;\n\t#onClickCallback: ?() => {};\n\t#onRemoveCallback: ?() => {};\n\t#contentProviders = {\n\t\tdate: Date,\n\t\tmyrequisites: MyRequisites,\n\t\tmysign: MySign,\n\t\tmystamp: MyStamp,\n\t\tnumber: Number,\n\t\treference: Reference,\n\t\tmyreference: MyReference,\n\t\trequisites: Requisites,\n\t\tsign: Sign,\n\t\tstamp: Stamp,\n\t\ttext: Text,\n\t};\n\t#currentFontSize: String;\n\n\t#style = {\n\t\tblockContent: '.sign-document__block-content',\n\t\tblockPanel: '.sign-document__block-panel--wrapper',\n\t\tblockLoading: 'sign-document-block-loading',\n\t\tblockEditing: 'sign-document__block-wrapper-editing',\n\t\tpageWithNotAllowed: 'sign-editor__content-document--active-move',\n\t};\n\n\t#firstRenderReady: boolean;\n\n\t#api: Api;\n\n\t/**\n\t * Constructor.\n\t * @param {BlockOptions} options\n\t */\n\tconstructor(options: BlockOptions)\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.Editor.Block');\n\t\tthis.blocksManager = options.blocksManager;\n\t\tthis.#id = options.id || null;\n\t\tthis.#code = options.code;\n\t\tthis.#memberPart = options.party;\n\t\tthis.#onClickCallback = options.onClick;\n\t\tthis.#onRemoveCallback = options.onRemove;\n\t\tthis.#firstRenderReady = null;\n\t\tthis.#stylePanel = new Style({\n\t\t\tblock: this,\n\t\t\tdata: options.style\n\t\t});\n\t\tif (!this.#contentProviders[this.#code])\n\t\t{\n\t\t\tthrow new Error(`Content provider for '${this.#code}' not found.`);\n\t\t}\n\n\t\tthis.#content = new this.#contentProviders[this.#code](this);\n\n\t\tif (['sign', 'mysign'].includes(this.#code) && Type.isString(options.style?.color))\n\t\t{\n\t\t\tthis.#content.changeStyleColor(options.style.color, false);\n\t\t}\n\n\t\tthis.#createLayout();\n\n\t\tEvent.bind(this.#layout, 'click', this.#onClick.bind(this));\n\n\t\tif (options.party > 1)\n\t\t{\n\t\t\tthis.#allowMembers = true;\n\t\t}\n\n\t\tthis.renderStyle();\n\n\t\tthis.setPosition(options.position ?? this.#content.getInitDimension());\n\n\t\tif (options.data)\n\t\t{\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.setData(options.data);\n\t\t\t}, 0);\n\t\t}\n\t\tthis.#api = new Api();\n\t}\n\n\t/**\n\t * Returns block's layout.\n\t * @return {HTMLElement}\n\t */\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#layout;\n\t}\n\n\t/**\n\t * Sets new data to the block.\n\t * @param {any} data\n\t */\n\tsetData(data: any)\n\t{\n\t\tthis.#content.setData(data);\n\t\tthis.renderView();\n\t}\n\n\t/**\n\t * Sets initial position to the block.\n\t * @param {PositionType} position\n\t */\n\tsetPosition(position: PositionType)\n\t{\n\t\tUI.setRect(this.#layout, position);\n\t}\n\n\t/**\n\t * Returns block's data.\n\t * @return {any}\n\t */\n\tgetData(): any\n\t{\n\t\treturn this.#content.getData();\n\t}\n\n\t/**\n\t * Returns position.\n\t * @return {PositionType}\n\t */\n\tgetPosition(): PositionType\n\t{\n\t\tlet {top, left, width, height} = this.#layout.getBoundingClientRect();\n\t\tconst layout = this.#layout;\n\t\ttop = Math.round(top);\n\t\tleft = Math.round(left);\n\t\twidth = Math.round(width);\n\t\theight = Math.round(height);\n\n\t\tconst documentRect = this.blocksManager.getLayout().getBoundingClientRect();\n\n\t\ttop -= Math.round(documentRect.top);\n\t\tleft -= Math.round(documentRect.left);\n\n\t\treturn {top, left, width, height};\n\t}\n\n\t/**\n\t * Returns block styles.\n\t * @return {{{[key: string]: string}}}\n\t */\n\tgetStyle(): {[key: string]: string}\n\t{\n\t\treturn { ...this.#content.getStyles(), ...this.#stylePanel.collectStyles() };\n\t}\n\n\t/**\n\t * Returns id.\n\t * @return {number|null}\n\t */\n\tgetId(): ?number\n\t{\n\t\treturn this.#id ?? null;\n\t}\n\n\t/**\n\t * Returns code.\n\t * @return {string}\n\t */\n\tgetCode(): string\n\t{\n\t\treturn this.#code;\n\t}\n\n\t/**\n\t * Shows page's areas not allowed for block's placement.\n\t */\n\tshowNotAllowedArea()\n\t{\n\t\tconst {page} = this.blocksManager.transferPositionToPage(this.getPosition());\n\t\tconst pageElement = document.querySelector(`.sign-editor__content-document--page[data-page=\"${page}\"]`);\n\n\t\tDom.addClass(pageElement, this.#style.pageWithNotAllowed);\n\t}\n\n\thideNotAllowedArea()\n\t{\n\t\tconst {page} = this.blocksManager.transferPositionToPage(this.getPosition());\n\t\tconst pageElement = document.querySelector(`.sign-editor__content-document--page[data-page=\"${page}\"]`);\n\n\t\tDom.removeClass(pageElement, this.#style.pageWithNotAllowed);\n\t}\n\n\t/**\n\t * Returns member part.\n\t * @return {number}\n\t */\n\tgetMemberPart(): number\n\t{\n\t\treturn this.#memberPart;\n\t}\n\n\t/**\n\t * Handler on click to block.\n\t */\n\t#onClick()\n\t{\n\t\tif (this.#onClickCallback)\n\t\t{\n\t\t\tthis.#onClickCallback(this);\n\t\t}\n\t}\n\n\t/**\n\t * Calls block's action.\n\t */\n\tfireAction()\n\t{\n\t\tif (this.#content['onActionClick'])\n\t\t{\n\t\t\tif (this.#code === 'text')\n\t\t\t{\n\t\t\t\tDom.addClass(this.#layout, this.#style.blockEditing);\n\t\t\t}\n\t\t\tthis.#content['onActionClick']();\n\t\t}\n\t}\n\n\t/**\n\t * Handler on member change.\n\t * @param {number} part\n\t */\n\tonMemberSelect(part: number)\n\t{\n\t\tthis.#memberPart = part;\n\t\tthis.assign();\n\t}\n\n\t/**\n\t * Sets/removes awaiting class to the block.\n\t * @param {boolean} flag\n\t */\n\tawait(flag: boolean)\n\t{\n\t\tconst blockLayouts = [];\n\n\t\tif (!this.#content.isSingleton())\n\t\t{\n\t\t\tblockLayouts.push(this.getLayout());\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst currentCode = this.getCode();\n\n\t\t\tthis.blocksManager.getBlocks().map(block => {\n\t\t\t\tif (block.getCode() === currentCode)\n\t\t\t\t{\n\t\t\t\t\tblockLayouts.push(block.getLayout());\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tblockLayouts.map((blockLayout, key) => {\n\t\t\tif (flag)\n\t\t\t{\n\t\t\t\tif (blockLayouts.length === key + 1)\n\t\t\t\t{\n\t\t\t\t\tDom.addClass(blockLayout, this.#style.blockLoading);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tDom.removeClass(blockLayout, this.#style.blockLoading);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Assigns block to the document (without saving).\n\t */\n\tassign()\n\t{\n\t\tconst blockLayout = this.getLayout();\n\t\tconst blocksData = [];\n\t\tconst blocksInstance = [];\n\n\t\tthis.await(true);\n\n\t\tif (!this.#content.isSingleton())\n\t\t{\n\t\t\tblocksData.push({\n\t\t\t\tcode: this.#code,\n\t\t\t\tpart: this.#memberPart,\n\t\t\t\tdata: this.getData()\n\t\t\t});\n\t\t\tblocksInstance.push(this);\n\t\t}\n\t\t// if block is a singleton push all blocks with same code\n\t\telse\n\t\t{\n\t\t\tthis.blocksManager.getBlocks().map(block => {\n\t\t\t\tif (\n\t\t\t\t\tblock.getCode() === this.getCode() &&\n\t\t\t\t\tblock.getMemberPart() === this.getMemberPart()\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tblocksData.push({\n\t\t\t\t\t\tcode: block.getCode(),\n\t\t\t\t\t\tpart: block.getMemberPart(),\n\t\t\t\t\t\tdata: block.getData()\n\t\t\t\t\t});\n\t\t\t\t\tblocksInstance.push(block);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tthis.#api.loadBlocksData(\n\t\t\tthis.blocksManager.getDocumentUid(),\n\t\t\tblocksData\n\t\t).then(result => {\n\t\t\tif (Type.isArray(result))\n\t\t\t{\n\t\t\t\tresult.forEach((block, i) => {\n\t\t\t\t\tblocksInstance[i].setData(block.data);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tthis.await(false);\n\t\t\tthis.blocksManager.showResizeArea(this);\n\t\t})\n\t\t.catch((response) => {\n\t\t\tDom.remove(blockLayout);\n\t\t});\n\t}\n\n\t/**\n\t * Renders block within document's layout.\n\t */\n\trenderView()\n\t{\n\t\tconst contentTag = this.#layout.querySelector(this.#style.blockContent);\n\n\t\t// content\n\t\tDom.clean(contentTag);\n\n\t\tswitch (this.#code.toLowerCase())\n\t\t{\n\t\t\tcase 'stamp':\n\t\t\tcase 'mystamp':\n\t\t\tcase 'sign':\n\t\t\tcase 'mysign':\n\t\t\t\tDom.addClass(contentTag, '--image')\n\t\t}\n\n\t\tconst resizeNode = this.#content.getViewContent();\n\n\t\tDom.append(resizeNode, contentTag);\n\n\t\tDom.addClass(resizeNode, '--' + this.#code.toLowerCase());\n\n\t\tif (\n\t\t\tthis.#code.toLowerCase() === 'requisites'\n\t\t\t|| this.#code.toLowerCase() === 'myrequisites'\n\t\t\t|| this.#code.toLowerCase() === 'date'\n\t\t\t|| this.#code.toLowerCase() === 'number'\n\t\t\t|| this.#code.toLowerCase() === 'stamp'\n\t\t\t|| this.#code.toLowerCase() === 'mystamp'\n\t\t\t|| this.#code.toLowerCase() === 'sign'\n\t\t\t|| this.#code.toLowerCase() === 'mysign'\n\t\t\t|| this.#code.toLowerCase() === 'reference'\n\t\t\t|| this.#code.toLowerCase() === 'myreference'\n\t\t\t|| this.#code.toLowerCase() === 'text'\n\t\t)\n\t\t{\n\t\t\tresizeNode.style.setProperty('display', 'block');\n\t\t\tresizeNode.style.setProperty('overflow', 'hidden');\n\n\t\t\tif (!this.observerReady)\n\t\t\t{\n\t\t\t\tif (this.getStyle()['fontSize'])\n\t\t\t\t{\n\t\t\t\t\tthis.maxTextSize = parseFloat(this.getStyle()['fontSize']);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tthis.maxTextSize = 14;\n\t\t\t\t}\n\n\t\t\t\tthis.isOverflownX = ({ clientHeight, scrollHeight }) => {\n\t\t\t\t\treturn scrollHeight > clientHeight;\n\t\t\t\t}\n\n\t\t\t\tEventEmitter.subscribe(resizeNode.parentNode.parentNode, 'BX.Sign:setFontSize', (param)=> {\n\t\t\t\t\tif (param.data.fontSize)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.maxTextSize = param.data.fontSize;\n\t\t\t\t\t\tthis.resizeText({\n\t\t\t\t\t\t\telement: param.target.querySelector('.sign-document__block-content > div'),\n\t\t\t\t\t\t\tstep: 0.5\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tthis.resizeText = ({ element, minSize = 1, step = 1, unit = 'px' }) => {\n\n\t\t\t\t\tif (this.intervalTextResize)\n\t\t\t\t\t{\n\t\t\t\t\t\tclearTimeout(this.intervalTextResize);\n\t\t\t\t\t}\n\n\t\t\t\t\tlet i = minSize;\n\t\t\t\t\tlet overflow = false;\n\n\t\t\t\t\tconst parent = element.parentNode\n\n\t\t\t\t\twhile (!overflow && i < this.maxTextSize)\n\t\t\t\t\t{\n\t\t\t\t\t\telement.style.fontSize = `${i}${unit}`;\n\t\t\t\t\t\toverflow = this.isOverflownX(parent);\n\t\t\t\t\t\tif (!overflow)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ti += step;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tthis.#currentFontSize = `${i - step}${unit}`;\n\t\t\t\t\telement.style.fontSize = this.#currentFontSize;\n\n\t\t\t\t\tthis.intervalTextResize = setTimeout(() => {\n\t\t\t\t\t\telement.parentNode.style.setProperty('font-size', element.style.fontSize);\n\t\t\t\t\t\telement.style.removeProperty('font-size', element.style.fontSize);\n\t\t\t\t\t\tthis.#stylePanel.updateFontSize(this.#currentFontSize);\n\t\t\t\t\t}, 1000);\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\tthis.#code.toLowerCase() === 'requisites'\n\t\t\t\t\t|| this.#code.toLowerCase() === 'myrequisites'\n\t\t\t\t\t|| this.#code.toLowerCase() === 'reference'\n\t\t\t\t\t|| this.#code.toLowerCase() === 'myreference'\n\t\t\t\t\t|| this.#code.toLowerCase() === 'text'\n\t\t\t\t)\n\t\t\t\t{\n\t\t\t\t\tthis.resizeText({\n\t\t\t\t\t\telement: resizeNode,\n\t\t\t\t\t\tstep: 0.5\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthis.#content.subscribe(this.#content.events.onChange, this.#onContentChange.bind(this));\n\t\t\t\tthis.#content.subscribe(this.#content.events.onColorStyleChange, this.#onContentColorStyleChange.bind(this));\n\t\t\t\tthis.#content.subscribe('onFieldSelect', this.#onFieldSelect.bind(this));\n\n\t\t\t\tthis.observerReady = true;\n\t\t\t}\n\n\t\t\tif (this.#firstRenderReady)\n\t\t\t{\n\t\t\t\tthis.resizeText({\n\t\t\t\t\telement: resizeNode,\n\t\t\t\t\tstep: 0.5\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tthis.#firstRenderReady = true;\n\n\t\tif (this.#panelCreated)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\t// action / style panel\n\t\tconst panelTag = this.#layout.querySelector(this.#style.blockPanel);\n\t\tDom.clean(panelTag);\n\n\t\t// style\n\t\tif (this.#content.isStyleAllowed())\n\t\t{\n\t\t\tDom.append(this.#stylePanel.getLayout(), panelTag);\n\t\t}\n\n\t\t// action\n\t\tDom.append(this.#content.getActionButton(), panelTag);\n\n\t\t// block caption\n\t\tDom.append(this.#content.getBlockCaption(), panelTag);\n\n\t\t// member selector\n\t\tif (this.#allowMembers)\n\t\t{\n\t\t\tconst allMembers = this.blocksManager.getMembers();\n\t\t\tconst selectedMembers = allMembers.filter((member) => {\n\t\t\t\treturn member.part > 1\n\t\t\t});\n\t\t\tDom.append(UI.getMemberSelector(\n\t\t\t\tselectedMembers,\n\t\t\t\tthis.#memberPart,\n\t\t\t\tthis.onMemberSelect.bind(this)\n\t\t\t), panelTag);\n\t\t}\n\n\t\tthis.#panelCreated = true;\n\t}\n\n\tgetCurrentFontSize()\n\t{\n\t\treturn this.#currentFontSize;\n\t}\n\n\t/**\n\t * Calls when block starts being resized or moved.\n\t */\n\tonStartChangePosition()\n\t{\n\t\tthis.#content.onStartChangePosition();\n\t}\n\n\t/**\n\t * Calls when block has placed on document.\n\t */\n\tonPlaced()\n\t{\n\t\tthis.#content.onPlaced();\n\t}\n\n\tupdateColor(color: string, emitEvent: boolean = true): void\n\t{\n\t\tthis.#content.changeStyleColor(color, emitEvent);\n\t\tthis.#stylePanel.updateColor(color);\n\t}\n\n\t/**\n\t * Calls when block saved.\n\t */\n\tonSave()\n\t{\n\t\tthis.#content.onSave();\n\t}\n\n\t/**\n\t * Calls when block removed.\n\t */\n\tonRemove()\n\t{\n\t\tthis.#content.onRemove();\n\t}\n\n\t/**\n\t * Calls when click was out the block.\n\t */\n\tonClickOut()\n\t{\n\t\tthis.#content.onClickOut();\n\t}\n\n\t/**\n\t * Set block styles to layout.\n\t */\n\trenderStyle()\n\t{\n\t\tthis.#stylePanel.applyStyles(\n\t\t\tthis.#layout.querySelector(this.#style.blockContent)\n\t\t);\n\t}\n\n\t/**\n\t * Adjust actions panel.\n\t */\n\tadjustActionsPanel()\n\t{\n\t\tconst blockLayout = this.getLayout();\n\t\tconst documentLayout = this.blocksManager.getLayout().parentElement;\n\t\tconst documentLayoutRect = documentLayout.getBoundingClientRect();\n\t\tconst actionsPanel = blockLayout.querySelector('[data-role=\"sign-block__actions\"]');\n\n\t\tif (actionsPanel)\n\t\t{\n\t\t\tconst actionsPanelRect = actionsPanel.getBoundingClientRect();\n\t\t\tconst marginLeft = parseFloat(getComputedStyle(actionsPanel).marginLeft);\n\n\t\t\tif (documentLayoutRect.x >= actionsPanelRect.x)\n\t\t\t{\n\t\t\t\tactionsPanel.style.marginLeft = documentLayoutRect.x - actionsPanelRect.x + marginLeft + 'px';\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tactionsPanel.style.marginLeft = 0;\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Force saves the block.\n\t */\n\tforceSave()\n\t{\n\t\tthis.#layout.querySelector('[data-role=\"saveAction\"]').click();\n\t}\n\n\t/**\n\t * Creates layout for new block within document.\n\t */\n\t#createLayout()\n\t{\n\t\tthis.#layout = UI.getBlockLayout({\n\t\t\tonSave: (event) => {\n\t\t\t\tthis.renderView();\n\t\t\t\tthis.blocksManager.unMuteResizeArea();\n\t\t\t\tthis.blocksManager.hideResizeArea();\n\t\t\t\tthis.blocksManager.setSavingMark(false);\n\t\t\t\tthis.onSave();\n\n\t\t\t\tDom.removeClass(this.#layout, this.#style.blockEditing);\n\n\t\t\t\tevent.stopPropagation();\n\t\t\t},\n\t\t\tonRemove: this.#onRemoveBtnClick.bind(this),\n\t\t});\n\t\tconst nodeForPosition = document.body.querySelector('.sign-editor__content');\n\t\tconst documentLayout = this.blocksManager.getLayout();\n\t\tconst documentLayoutRect = documentLayout.getBoundingClientRect();\n\t\tconst blockInitDim = this.#content.getInitDimension();\n\t\tconst position = {\n\t\t\ttop: Math.min(nodeForPosition.scrollTop + nodeForPosition.offsetHeight / 2, documentLayoutRect.height - blockInitDim.height),\n\t\t\tleft: documentLayoutRect.width / 2 - 100\n\t\t};\n\n\t\tif (this.blocksManager.inDeadZone(position.top, position.top + blockInitDim.height))\n\t\t{\n\t\t\tposition.top += blockInitDim.height + this.blocksManager.getPagesGap();\n\t\t}\n\n\t\tthis.setPosition(position);\n\t}\n\n\tremove(): void\n\t{\n\t\tif (this.#onRemoveCallback)\n\t\t{\n\t\t\tthis.#onRemoveCallback(this);\n\t\t}\n\t\tthis.#layout.hidden = true;\n\t\tthis.onRemove();\n\t}\n\n\t#onRemoveBtnClick(event): void\n\t{\n\t\tthis.remove();\n\t\tevent.stopPropagation();\n\t}\n\n\t/**\n\t * Returns true, if block was removed.\n\t * @return {boolean}\n\t */\n\tisRemoved()\n\t{\n\t\treturn this.#layout.hidden === true;\n\t}\n\n\t#onContentChange(): void\n\t{\n\t\tconst content = this.#content;\n\t\tif (!(content instanceof Text))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.resizeText({ element: content.getContainer(), step: 0.5 });\n\t}\n\n\t#onContentColorStyleChange(event): void\n\t{\n\t\tthis.emit(this.events.onColorStyleChange, { color: this.#content.getStyles()?.color ?? null });\n\t\tconst color = this.#content.getStyles()?.color ?? null;\n\t\tif (Type.isString(color))\n\t\t{\n\t\t\tthis.#stylePanel.updateColor(color);\n\t\t}\n\t}\n\n\t#onFieldSelect(event: FieldSelectEvent): void\n\t{\n\t\tthis.emit('onFieldSelect', event);\n\t}\n}\n","import { Dom, Event, Type } from 'main.core';\nimport { Draggable, DragMoveEvent, DragStartEvent, DragEndEvent } from 'ui.draganddrop.draggable';\nimport { EventEmitter } from 'main.core.events';\nimport Block from './block';\nimport UI from './ui';\n\ntype ResizeOptions = {\n\twrapperLayout: HTMLElement\n};\n\nexport default class Resize\n{\n\tstatic borderDelta = 2;\n\n\t#wrapperLayout: HTMLElement;\n\t#layout: HTMLElement;\n\t#fullEditorContent: HTMLElement;\n\t#linkedElement: HTMLElement;\n\t#linkedBlock: Block;\n\n\tposition: DOMRect;\n\tpositionLast: { ...DOMRect, notAddDeathMargin?: boolean };\n\tresizing: boolean;\n\tmoving: boolean;\n\n\t#style = {\n\t\tresizeContainer: '.sign-area-resizable-controls > div',\n\t\tmoveContainer: '.sign-document__resize-area',\n\t\tblockEditing: 'sign-document__block-wrapper-editing'\n\t};\n\n\t/**\n\t * Constructor.\n\t * @param {ResizeOptions} options\n\t */\n\tconstructor(options: ResizeOptions)\n\t{\n\t\tif (!Type.isDomNode(options.wrapperLayout))\n\t\t{\n\t\t\tthrow new Error('Option wrapperLayout is undefined or not valid DOM Element.');\n\t\t}\n\n\t\tthis.#layout = UI.getResizeArea();\n\t\tthis.#wrapperLayout = options.wrapperLayout;\n\t\tEvent.bind(this.#layout, 'click', this.#onClick.bind(this));\n\n\t\tthis.#initResize();\n\t\tthis.#initMove();\n\t}\n\n\t/**\n\t * Returns layout of resizing area.\n\t * @return {HTMLElement}\n\t */\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#layout;\n\t}\n\n\t/**\n\t * Shows resizing area over the element.\n\t * @param {Block} block\n\t */\n\tshow(block: Block)\n\t{\n\t\tif (this.#linkedBlock === block)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst pointRect = block.getLayout().getBoundingClientRect();\n\t\tthis.#layout.style.display = 'block';\n\n\t\tif (this.#linkedElement)\n\t\t{\n\t\t\tthis.#linkedElement.removeAttribute('data-active');\n\t\t}\n\t\tthis.#linkedBlock = block;\n\t\tthis.#linkedElement = block.getLayout();\n\t\tthis.#linkedElement.setAttribute('data-active', 1);\n\t\tconst wrapperLayoutRect = this.#wrapperLayout.getBoundingClientRect();\n\t\tUI.setRect(this.#layout, {\n\t\t\ttop: pointRect.top - wrapperLayoutRect.top,\n\t\t\tleft: pointRect.left - wrapperLayoutRect.left,\n\t\t\twidth: pointRect.width + Resize.borderDelta,\n\t\t\theight: pointRect.height + Resize.borderDelta,\n\t\t});\n\t}\n\n\tsetFullEditorContent(editorContent: HTMLElement)\n\t{\n\t\tthis.#fullEditorContent = editorContent;\n\t}\n\n\t/**\n\t * Hides resizing area.\n\t */\n\thide()\n\t{\n\t\tthis.#linkedBlock = null;\n\t\tthis.#layout.style.display = 'none';\n\n\t\tif (this.#linkedElement)\n\t\t{\n\t\t\tthis.#linkedElement.removeAttribute('data-active');\n\t\t}\n\t}\n\n\t/**\n\t * Returns linked block.\n\t * @return {Block|null}\n\t */\n\tgetLinkedBlock(): ?Block\n\t{\n\t\treturn this.#linkedBlock;\n\t}\n\n\t/**\n\t * On click handler (provide click to linked element).\n\t */\n\t#onClick(e)\n\t{\n\t\tif (this.moving || this.resizing)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.#linkedBlock)\n\t\t{\n\t\t\tthis.#linkedBlock.fireAction();\n\t\t}\n\t}\n\n\t/**\n\t * Initializes resizing.\n\t */\n\t#initResize()\n\t{\n\t\tlet initialRect = null;\n\n\t\tconst draggable = new Draggable({\n\t\t\tcontainer: this.#wrapperLayout,\n\t\t\tdraggable: this.#style.resizeContainer,\n\t\t\ttype: BX.UI.DragAndDrop.Draggable.HEADLESS\n\t\t});\n\n\t\tthis.textResize = {\n\t\t\twrapper: null,\n\t\t\tcontent: null\n\t\t};\n\n\t\tdraggable\n\t\t\t.subscribe('start', (event: DragStartEvent) => {\n\t\t\t\tif (this.#layout.getAttribute('data-disable'))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!this.textResize.wrapper || !this.textResize.content)\n\t\t\t\t{\n\t\t\t\t\tthis.textResize = {\n\t\t\t\t\t\twrapper: this.#linkedBlock.getLayout(),\n\t\t\t\t\t\tcontent: this.#linkedBlock.getLayout().querySelector('.sign-document__block-content')\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tEventEmitter.emit('BX.Sign:resizeStart', draggable);\n\t\t\t\tinitialRect = this.#layout.getBoundingClientRect();\n\t\t\t\tthis.#linkedBlock.onStartChangePosition();\n\t\t\t\tthis.positionLast = null;\n\n\t\t\t\tDom.removeClass(this.#linkedBlock.getLayout(), this.#style.blockEditing);\n\t\t\t})\n\t\t\t.subscribe('end', (event: DragEndEvent) => {\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.resizing = false;\n\t\t\t\t}, 0);\n\n\t\t\t})\n\t\t\t.subscribe('move', (event) => {\n\n\t\t\t\tif (this.#layout.getAttribute('data-disable'))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.resizing = true;\n\n\t\t\t\tlet left = null;\n\t\t\t\tlet top = null;\n\t\t\t\tlet bottomResize = false;\n\t\t\t\tlet {width, height} = initialRect;\n\n\t\t\t\tconst data = event.getData();\n\t\t\t\tconst areaRect = this.#layout.getBoundingClientRect();\n\t\t\t\tconst wrapperRect = this.#wrapperLayout.getBoundingClientRect();\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --left-top'))\n\t\t\t\t{\n\t\t\t\t\tleft = Math.max(0, initialRect.left + data.offsetX - wrapperRect.left);\n\t\t\t\t\ttop = Math.max(0, initialRect.top + data.offsetY - wrapperRect.top);\n\t\t\t\t\twidth = initialRect.width - data.offsetX;\n\t\t\t\t\theight = initialRect.height - data.offsetY;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --middle-top'))\n\t\t\t\t{\n\t\t\t\t\ttop = Math.max(0, initialRect.top + data.offsetY - wrapperRect.top);\n\t\t\t\t\theight = initialRect.height - data.offsetY;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --right-top'))\n\t\t\t\t{\n\t\t\t\t\ttop = Math.max(0, initialRect.top + data.offsetY - wrapperRect.top);\n\t\t\t\t\twidth = initialRect.width + data.offsetX;\n\t\t\t\t\theight = initialRect.height - data.offsetY;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --middle-right'))\n\t\t\t\t{\n\t\t\t\t\twidth = initialRect.width + data.offsetX;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --right-bottom'))\n\t\t\t\t{\n\t\t\t\t\twidth = initialRect.width + data.offsetX;\n\t\t\t\t\theight = initialRect.height + data.offsetY;\n\t\t\t\t\tbottomResize = true;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --middle-bottom'))\n\t\t\t\t{\n\t\t\t\t\theight = initialRect.height + data.offsetY;\n\t\t\t\t\tbottomResize = true;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --left-bottom'))\n\t\t\t\t{\n\t\t\t\t\tleft = initialRect.left + data.offsetX - wrapperRect.left;\n\t\t\t\t\twidth = initialRect.width - data.offsetX;\n\t\t\t\t\theight = initialRect.height + data.offsetY;\n\t\t\t\t\tbottomResize = true;\n\t\t\t\t}\n\n\t\t\t\tif (Dom.hasClass(data.draggable, 'sign-document__resize-control --middle-left'))\n\t\t\t\t{\n\t\t\t\t\tleft = initialRect.left + data.offsetX - wrapperRect.left;\n\t\t\t\t\twidth = initialRect.width - data.offsetX;\n\t\t\t\t}\n\n\t\t\t\tif (width < 60 || height < 20)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst newPosition = { width, height };\n\n\t\t\t\tif (newPosition['width'] + areaRect.left - wrapperRect.left > wrapperRect.width)\n\t\t\t\t{\n\t\t\t\t\twidth = newPosition['width'] = wrapperRect.width + wrapperRect.left - areaRect.left;\n\t\t\t\t}\n\n\t\t\t\tif (newPosition['height'] + areaRect.top - wrapperRect.top > wrapperRect.height)\n\t\t\t\t{\n\t\t\t\t\theight = newPosition['height'] = wrapperRect.height + wrapperRect.top - areaRect.top;\n\t\t\t\t}\n\n\t\t\t\tif (left)\n\t\t\t\t{\n\t\t\t\t\tif (left < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tleft = 0;\n\t\t\t\t\t}\n\t\t\t\t\tnewPosition['left'] = left;\n\t\t\t\t}\n\t\t\t\tif (top)\n\t\t\t\t{\n\t\t\t\t\tnewPosition['top'] = top;\n\t\t\t\t}\n\n\t\t\t\tlet calcDeathTop = initialRect.top;\n\t\t\t\tlet notAddDeathMargin = true;\n\t\t\t\tif (newPosition.top)\n\t\t\t\t{\n\t\t\t\t\tcalcDeathTop = newPosition.top;\n\t\t\t\t\tnotAddDeathMargin = false;\n\t\t\t\t}\n\n\t\t\t\tif (this.#linkedBlock.blocksManager.inDeadZone(calcDeathTop, calcDeathTop + newPosition.height, notAddDeathMargin))\n\t\t\t\t{\n\t\t\t\t\tif (!bottomResize)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#linkedBlock.showNotAllowedArea();\n\t\t\t\t\t}\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst newPositionLinked = Object.assign({}, {\n\t\t\t\t\t...newPosition,\n\t\t\t\t\twidth: width - Resize.borderDelta,\n\t\t\t\t\theight: height - Resize.borderDelta,\n\t\t\t\t});\n\n\t\t\t\tUI.setRect(this.#layout, newPosition);\n\t\t\t\tUI.setRect(this.#linkedElement, newPositionLinked);\n\n\t\t\t\tthis.#linkedBlock.renderView();\n\t\t\t\tthis.#linkedBlock.blocksManager.setSavingMark(false);\n\t\t\t\tthis.#linkedBlock.adjustActionsPanel();\n\t\t\t});\n\t}\n\n\t/**\n\t * Initializes moving.\n\t */\n\t#initMove()\n\t{\n\t\tconst dragArea = this.#wrapperLayout;\n\t\tlet widthInProcess;\n\n\t\tconst draggable = new Draggable({\n\t\t\tcontainer: dragArea,\n\t\t\tdraggable: this.#style.moveContainer,\n\t\t\ttype: Draggable.HEADLESS\n\t\t});\n\n\t\tdraggable\n\t\t\t.subscribe('start', (event: DragStartEvent) => {\n\n\t\t\t\tif (this.#layout.getAttribute('data-disable'))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tEventEmitter.emit('BX.Sign:moveStart', draggable);\n\n\t\t\t\tif (this.resizing)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst {source} = event.getData();\n\t\t\t\tthis.position = Dom.getPosition(source);\n\t\t\t\tthis.#linkedBlock.onStartChangePosition();\n\t\t\t\tthis.positionLast = null;\n\n\t\t\t\tDom.removeClass(this.#linkedBlock.getLayout(), this.#style.blockEditing);\n\t\t\t})\n\t\t\t.subscribe('end', (event: DragEndEvent) => {\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.moving = false;\n\t\t\t\t}, 0);\n\n\t\t\t\tif (!this.#linkedBlock)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.resizing)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\twidthInProcess = null;\n\n\t\t\t\tconst data = event.getData();\n\t\t\t\tlet moveTopDelta = null;\n\t\t\t\tif (this.positionLast)\n\t\t\t\t{\n\t\t\t\t\tmoveTopDelta = this.#linkedBlock.blocksManager.inDeadZone(this.positionLast.top, this.positionLast.top + this.positionLast.height);\n\t\t\t\t}\n\n\t\t\t\tthis.#linkedBlock.hideNotAllowedArea();\n\n\t\t\t\tif (moveTopDelta)\n\t\t\t\t{\n\t\t\t\t\tUI.setRect(data.source, {top: this.positionLast.top + moveTopDelta});\n\t\t\t\t\tUI.setRect(this.#linkedElement, {top: this.positionLast.top + moveTopDelta});\n\t\t\t\t}\n\t\t\t})\n\t\t\t.subscribe('move', (event: DragMoveEvent) => {\n\n\t\t\t\tif (this.#layout.getAttribute('data-disable'))\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.resizing)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.moving = true;\n\n\t\t\t\tconst data = event.getData();\n\t\t\t\tconst {source, offsetY, offsetX} = data;\n\t\t\t\tconst areaRect = data.source.getBoundingClientRect();\n\t\t\t\tconst wrapperRect = this.#wrapperLayout.getBoundingClientRect();\n\n\t\t\t\tif (this.position)\n\t\t\t\t{\n\t\t\t\t\tconst newPosition = {\n\t\t\t\t\t\ttop: offsetY - wrapperRect.top + this.position.y,\n\t\t\t\t\t\tleft: offsetX - wrapperRect.left + this.position.x,\n\t\t\t\t\t\twidth: widthInProcess ? widthInProcess : this.position.width,\n\t\t\t\t\t\theight: this.position.height\n\t\t\t\t\t};\n\n\t\t\t\t\tif (newPosition.left < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewPosition.left = 0;\n\t\t\t\t\t}\n\t\t\t\t\tif (newPosition.top < 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewPosition.top = 0;\n\t\t\t\t\t}\n\t\t\t\t\tif (newPosition.top + areaRect.height > wrapperRect.height)\n\t\t\t\t\t{\n\t\t\t\t\t\tnewPosition.top = wrapperRect.height - areaRect.height;\n\t\t\t\t\t}\n\t\t\t\t\tif (newPosition.left + areaRect.width > wrapperRect.width)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#linkedBlock.renderView();\n\t\t\t\t\t\tif (wrapperRect.width - newPosition.left > 50)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\twidthInProcess = newPosition.width = wrapperRect.width - newPosition.left;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tnewPosition.left = wrapperRect.width - areaRect.width;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.positionLast = Object.assign({}, newPosition);\n\n\t\t\t\t\tlet moveTopDelta = null;\n\n\t\t\t\t\tif (this.positionLast)\n\t\t\t\t\t{\n\t\t\t\t\t\tmoveTopDelta = this.#linkedBlock.blocksManager.inDeadZone(this.positionLast.top, this.positionLast.top + this.positionLast.height);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (moveTopDelta > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#linkedBlock.showNotAllowedArea();\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.#linkedBlock.hideNotAllowedArea();\n\t\t\t\t\t}\n\n\t\t\t\t\tconst newPositionLinked = Object.assign({}, {\n\t\t\t\t\t\t...newPosition,\n\t\t\t\t\t\twidth: newPosition.width - Resize.borderDelta,\n\t\t\t\t\t\theight: newPosition.height - Resize.borderDelta,\n\t\t\t\t\t});\n\n\t\t\t\t\tUI.setRect(source, newPosition);\n\t\t\t\t\tUI.setRect(this.#linkedElement, newPositionLinked);\n\n\t\t\t\t\tthis.#linkedBlock.blocksManager.setSavingMark(false);\n\t\t\t\t\tthis.#linkedBlock.adjustActionsPanel();\n\t\t\t\t}\n\t\t\t});\n\t}\n}\n","import { Dom, Event, Loc, Text, Type, Cache } from 'main.core';\nimport { BaseEvent, EventEmitter } from 'main.core.events';\nimport { Popup } from 'main.popup';\nimport { Backend } from 'sign.backend';\nimport { Guide } from 'sign.tour';\nimport { Api } from 'sign.v2.api';\nimport 'spotlight';\nimport { Button, ButtonColor } from 'ui.buttons';\nimport { MessageBox } from 'ui.dialogs.messagebox';\nimport 'ui.info-helper';\nimport { UI } from 'ui.notification';\nimport { BlockItem, Config, DocumentOptions, MemberItem, PositionType } from '../types/document';\nimport type { FieldSelectEvent } from '../types/events/FieldSelectEvent';\nimport Block from './block';\nimport Resize from './resize';\n\nconst marginTop = 0;\nconst gapBetweenPages = 20;\n\ntype EventListenerCache = Map<Block, {\n\tsubscription: (Block) => void,\n\teventName: string,\n}>;\n\nexport class BlocksManager\n{\n\t#documentId: number;\n\t#documentUid: string;\n\t#companyId: number;\n\t#initiatorName: string;\n\t#entityId: number;\n\t#blankId: number;\n\t#pagesMinHeight: number = 0;\n\t#disableEdit: boolean;\n\t#closeDemoContent: boolean = false;\n\t#members: Array<MemberItem>;\n\t#documentLayout: HTMLElement;\n\tresizeArea: Resize;\n\t#blocks: Array<Block> = [];\n\t#eventListeners: { [eventListenerCacheName: string]: EventListenerCache } = {\n\t\tblockColorChange: new Map(),\n\t\tblockReferenceFieldSelect: new Map(),\n\t};\n\t#pagesRects: Array<DOMRect> = [];\n\t#seams: Array<Array<number, number>> = [];\n\t#config: Config;\n\t#helpBtnElementId = 'sign-editor-help-btn';\n\t#helpBtnHelperArticleCode = '16571388';\n\t#api: Api;\n\t#lastContainerSize;\n\t#cache: Cache.MemoryCache = new Cache.MemoryCache();\n\n\t/**\n\t * Constructor.\n\t * @param {DocumentOptions} options\n\t */\n\tconstructor(options: DocumentOptions)\n\t{\n\t\tconst { documentLayout, disableEdit } = options;\n\t\tthis.#documentLayout = documentLayout;\n\t\tthis.#disableEdit = disableEdit;\n\t\tif (!this.#disableEdit)\n\t\t{\n\t\t\tthis.resizeArea = new Resize({ wrapperLayout: this.#documentLayout });\n\t\t\tDom.append(this.resizeArea.getLayout(), this.#documentLayout);\n\t\t}\n\n\t\tEvent.bind(documentLayout, 'click', ({ target }) => {\n\t\t\tconst preventClickOut = target.closest('.sign-document__block-wrapper') ||\n\t\t\t\ttarget.closest('.sign-document__resize-area');\n\t\t\tif (preventClickOut)\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst activeBlock = this.resizeArea.getLinkedBlock();\n\t\t\tactiveBlock?.onClickOut();\n\t\t});\n\t\tthis.#api = new Api();\n\t\tthis.#lastContainerSize = {\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t};\n\t}\n\n\tinitPagesRect()\n\t{\n\t\tlet top = 0;\n\t\tconst pages = [...this.#documentLayout.querySelectorAll('.sign-editor__document_page img')];\n\t\tthis.#pagesRects = [];\n\t\tthis.#seams = [];\n\t\tconst content = document.querySelector('.sign-editor__content');\n\t\tpages.forEach(page => {\n\t\t\tconst pageRect = page.getBoundingClientRect();\n\t\t\tconst pageRectToMath = {};\n\n\t\t\t// round getBoundingClientRect\n\t\t\tfor (let pageRectKey in pageRect)\n\t\t\t{\n\t\t\t\tif (Type.isNumber(pageRect[pageRectKey]))\n\t\t\t\t{\n\t\t\t\t\tpageRectToMath[pageRectKey] = Math.round(pageRect[pageRectKey]);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tpageRectToMath[pageRectKey] = pageRect[pageRectKey];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst topBound = top === 0 ? 0 : pageRectToMath.top - gapBetweenPages + content.scrollTop;\n\t\t\tconst bottomBound = pageRectToMath.top + marginTop + content.scrollTop;\n\t\t\t// collect seam's gaps\n\t\t\tthis.#seams.push([topBound, bottomBound]);\n\n\t\t\t// correct top after rounding\n\t\t\tif (top === 0)\n\t\t\t{\n\t\t\t\ttop = pageRectToMath.top;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\ttop += gapBetweenPages;\n\t\t\t\tpageRectToMath.top = top;\n\t\t\t}\n\n\t\t\t// collect pages rects\n\t\t\tthis.#pagesRects.push(pageRectToMath);\n\n\t\t\t// remember min page height\n\t\t\tif (!this.#pagesMinHeight || pageRect.height < this.#pagesMinHeight)\n\t\t\t{\n\t\t\t\tthis.#pagesMinHeight = pageRect.height;\n\t\t\t}\n\t\t});\n\t\tthis.#documentLayout.style.width = `${this.#documentLayout.offsetWidth}px`;\n\t}\n\n\t/**\n\t * Transfers absolute position to page position and sets page number.\n\t * @param {PositionType} position\n\t * @return {PositionType}\n\t */\n\ttransferPositionToPage(position: PositionType): PositionType\n\t{\n\t\tposition.page = 1;\n\n\t\tfor (\n\t\t\tlet i = 0,\n\t\t\t\tc = this.#pagesRects.length; i < c; i++\n\t\t)\n\t\t{\n\t\t\tconst height = this.#pagesRects[i].height;\n\n\t\t\tif (i !== 0) // skip gap for first page\n\t\t\t{\n\t\t\t\tposition.top -= gapBetweenPages;\n\t\t\t}\n\n\t\t\tposition.top -= height;\n\t\t\tif (position.top < 0)\n\t\t\t{\n\t\t\t\tposition.top += height;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tposition.page++;\n\t\t\t}\n\t\t}\n\n\t\treturn position;\n\t}\n\n\t/**\n\t * Transfers pixel of position to percent.\n\t * @param {PositionType} position\n\t * @return {PositionType}\n\t */\n\t#pixelToPercent(position: PositionType, pageRect): PositionType\n\t{\n\t\tposition.widthPx = position.width;\n\t\tposition.heightPx = position.height;\n\t\tposition.left = position.left * 100 / pageRect.width;\n\t\tposition.top = position.top * 100 / pageRect.height;\n\t\tposition.width = position.width / pageRect.width * 100;\n\t\tposition.height = position.height / pageRect.height * 100;\n\n\t\treturn position;\n\t}\n\n\t/**\n\t * Transfers percent of position to pixel.\n\t * @param {PositionType} position\n\t * @return {PositionType}\n\t */\n\t#percentToPixel(position: PositionType): PositionType\n\t{\n\t\tif (!position.page || typeof this.#pagesRects[position.page - 1] === 'undefined')\n\t\t{\n\t\t\treturn position;\n\t\t}\n\n\t\tconst pageImageRect = this.#pagesRects[position.page - 1];\n\t\tconst pixelPosition = {};\n\n\t\tif (typeof position.left === 'number')\n\t\t{\n\t\t\tpixelPosition.left = position.left * pageImageRect.width / 100;\n\t\t}\n\t\tif (typeof position.top === 'number')\n\t\t{\n\t\t\tlet top = position.top * pageImageRect.height / 100;\n\t\t\tlet pageNum = 0;\n\t\t\twhile (pageNum < position.page - 1)\n\t\t\t{\n\t\t\t\ttop += this.#pagesRects[pageNum].height + gapBetweenPages;\n\t\t\t\tpageNum++;\n\t\t\t}\n\n\t\t\tpixelPosition.top = top;\n\t\t}\n\t\tif (typeof position.width === 'number')\n\t\t{\n\t\t\tpixelPosition.width = position.width * pageImageRect.width / 100;\n\t\t}\n\t\tif (typeof position.height === 'number')\n\t\t{\n\t\t\tpixelPosition.height = position.height * pageImageRect.height / 100;\n\t\t}\n\n\t\treturn pixelPosition;\n\t}\n\n\t/**\n\t * Returns minimal pages height.\n\t * @return {number}\n\t */\n\tgetMinPageHeight(): number\n\t{\n\t\treturn this.#pagesMinHeight - marginTop;\n\t}\n\n\t/**\n\t * Returns document id.\n\t * @return {number}\n\t */\n\tgetDocumentId(): number\n\t{\n\t\treturn this.#documentId;\n\t}\n\n\tgetDocumentUid(): string\n\t{\n\t\treturn this.#documentUid;\n\t}\n\n\tsetEditorContent(editorContent: HTMLElement)\n\t{\n\t\tthis.resizeArea.setFullEditorContent(editorContent);\n\t}\n\n\tsetDocumentUid(documentUid: string): BlocksManager\n\t{\n\t\tthis.#documentUid = documentUid;\n\t\treturn this;\n\t}\n\n\t/**\n\t * Returns document entity id.\n\t * @return {number}\n\t */\n\tgetEntityId(): number\n\t{\n\t\treturn this.#entityId;\n\t}\n\n\t/**\n\t * Returns document's layout.\n\t * @return {HTMLElement}\n\t */\n\tgetLayout(): HTMLElement\n\t{\n\t\treturn this.#documentLayout;\n\t}\n\n\t/**\n\t * Returns number pairs (seams between pages).\n\t * @return {Array<Array<number, number>>}\n\t */\n\tgetSeams(): Array<Array<number, number>>\n\t{\n\t\treturn this.#seams;\n\t}\n\n\t/**\n\t * Returns gap between pages.\n\t * @return {number}\n\t */\n\tgetPagesGap(): number\n\t{\n\t\treturn gapBetweenPages + marginTop;\n\t}\n\n\taddMembers(members: Array<MemberItem>)\n\t{\n\t\tthis.#members = members;\n\t}\n\n\t/**\n\t * Returns document's members\n\t * @return {Array<MemberItem>}\n\t */\n\tgetMembers(): Array<MemberItem>\n\t{\n\t\treturn this.#members;\n\t}\n\n\t/**\n\t * Returns member item by member part.\n\t * @param {number} part\n\t * @return {null}\n\t */\n\tgetMemberByPart(part: number): ?MemberItem\n\t{\n\t\tlet returnMember = null;\n\n\t\tthis.#members.map((member: MemberItem) => {\n\t\t\tif (member.part === part)\n\t\t\t{\n\t\t\t\treturnMember = member;\n\t\t\t}\n\t\t});\n\n\t\treturn returnMember;\n\t}\n\n\t/**\n\t * Returns company id.\n\t * @return {number}\n\t */\n\tgetCompanyId(): number\n\t{\n\t\treturn this.#companyId;\n\t}\n\n\t/**\n\t * @return {string}\n\t */\n\tgetInitiatorName(): string\n\t{\n\t\treturn this.#initiatorName;\n\t}\n\n\t/**\n\t * Returns Config object.\n\t * @return {Config}\n\t */\n\tgetConfig(): Config\n\t{\n\t\treturn this.#config;\n\t}\n\n\t/**\n\t * Hides resizing area.\n\t */\n\thideResizeArea()\n\t{\n\t\tthis.resizeArea.hide();\n\t}\n\n\t/**\n\t * Shows resizing area over the block.\n\t * @param {Block} block\n\t */\n\tshowResizeArea(block: Block)\n\t{\n\t\tthis.resizeArea.show(block);\n\t}\n\n\t/**\n\t * Mutes resizing area.\n\t */\n\tmuteResizeArea()\n\t{\n\t\tthis.resizeArea.getLayout().setAttribute('data-disable', 1);\n\t}\n\n\t/**\n\t * Unmutes resizing area.\n\t */\n\tunMuteResizeArea()\n\t{\n\t\tthis.resizeArea.getLayout().removeAttribute('data-disable');\n\t}\n\n\t/**\n\t * Adds block to the document.\n\t * @param {BlockItem} data Block data.\n\t * @param {boolean} seamShift If true, will be added seam shift to top's position.\n\t * @return {Block}\n\t */\n\t#addBlock(data: BlockItem, seamShift: boolean): Block\n\t{\n\t\tconst position = data.position ? this.#percentToPixel(data.position) : null;\n\t\tconst newBlock = new Block({\n\t\t\tid: data.id,\n\t\t\tcode: data.code,\n\t\t\tparty: data.party,\n\t\t\tblocksManager: this,\n\t\t\tdata: data.data,\n\t\t\tposition,\n\t\t\tstyle: data.style,\n\t\t\tonClick: (block: Block) => {\n\t\t\t\tif (this.#disableEdit)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.resizeArea.show(block);\n\t\t\t\tthis.unMuteResizeArea();\n\t\t\t\tblock.adjustActionsPanel();\n\t\t\t},\n\t\t\tonRemove: (block: Block) => {\n\t\t\t\tthis.resizeArea.hide();\n\t\t\t},\n\t\t});\n\t\tconst blockLayout = newBlock.getLayout();\n\t\tthis.#subscribeOnBlockEvents(newBlock);\n\n\t\tif (['sign', 'mysign'].includes(newBlock.getCode()))\n\t\t{\n\t\t\tconst existedSignBlock: Block | undefined = this.#blocks.find(block => block.getCode() === newBlock.getCode());\n\t\t\tconst signColor: string | undefined = existedSignBlock?.getStyle?.()?.color;\n\t\t\tif (!Type.isNil(signColor))\n\t\t\t{\n\t\t\t\tnewBlock.updateColor(signColor, false);\n\t\t\t}\n\t\t}\n\n\t\tthis.#blocks.push(newBlock);\n\n\t\tDom.append(blockLayout, this.#documentLayout);\n\n\t\treturn newBlock;\n\t}\n\n\t#subscribeOnBlockEvents(newBlock: Block): void\n\t{\n\t\tconst newBlockCode = newBlock.getCode();\n\n\t\tif (['sign', 'mysign'].includes(newBlockCode))\n\t\t{\n\t\t\tconst colorChangeListener = (event) => this.#onBlockColorStyleChange(newBlock, event);\n\t\t\tthis.#eventListeners.blockColorChange.set(\n\t\t\t\tnewBlock,\n\t\t\t\t{ subscription: colorChangeListener, eventName: newBlock.events.onColorStyleChange },\n\t\t\t);\n\t\t\tnewBlock.subscribe(\n\t\t\t\tnewBlock.events.onColorStyleChange,\n\t\t\t\tcolorChangeListener,\n\t\t\t);\n\t\t}\n\t\telse if (['myreference', 'reference'].includes(newBlockCode))\n\t\t{\n\t\t\tconst onFieldSelectListener = (event: FieldSelectEvent) => this.#onReferenceBlockFieldSelect(\n\t\t\t\tnewBlock,\n\t\t\t\tevent,\n\t\t\t);\n\t\t\tthis.#eventListeners.blockReferenceFieldSelect.set(\n\t\t\t\tnewBlock,\n\t\t\t\t{ subscription: onFieldSelectListener, eventName: 'onFieldSelect' },\n\t\t\t);\n\t\t\tnewBlock.subscribe(\n\t\t\t\t'onFieldSelect',\n\t\t\t\tonFieldSelectListener,\n\t\t\t);\n\t\t}\n\t}\n\n\t/**\n\t * Fires on click repository item.\n\t * @param {string} code Block code.\n\t * @param {string} part Member part (base - my company, other - third part).\n\t */\n\t#onRepositoryItemClick(code: string, party: number)\n\t{\n\t\tparty = parseInt(party);\n\t\tthis.setSavingMark(false);\n\n\t\tconst block = this.#addBlock({ code, party });\n\t\tblock.assign();\n\t\tblock.onPlaced();\n\t}\n\n\t/**\n\t * Sets exists blocks to the document.\n\t * @param blocks\n\t */\n\tinitBlocks(blocks: Array<BlockItem>)\n\t{\n\t\tthis.#unsubscribeFromBlocksEvents();\n\t\tthis.#blocks = [];\n\t\tthis.hideResizeArea();\n\t\tblocks.map(block => this.#addBlock(block, true));\n\t}\n\n\tinitRepository(repositoryItems: NodeList)\n\t{\n\t\t[...repositoryItems].forEach((item: HTMLElement) => {\n\n\t\t\tconst code = item.getAttribute('data-code');\n\t\t\tconst part = item.getAttribute('data-part');\n\n\t\t\tEvent.bind(item, 'click', e => {\n\t\t\t\tthis.#onRepositoryItemClick(code, part);\n\t\t\t\te.preventDefault();\n\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Returns blocks collection.\n\t * @return {Array<Block>}\n\t */\n\tgetBlocks(): Array<Block>\n\t{\n\t\treturn this.#blocks;\n\t}\n\n\t/**\n\t * Saves document and closes slider.\n\t * @return {Promise}\n\t */\n\tsave(): Promise<any, any>\n\t{\n\t\tconst postData = [];\n\n\t\tconst realDocumentWidth = document.querySelector('.sign-editor__document').offsetWidth;\n\n\t\tthis.#blocks.map(block => {\n\n\t\t\tif (block.isRemoved())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst blockLayout = block.getLayout();\n\t\t\tconst blockRect = blockLayout.getBoundingClientRect();\n\t\t\tconst pages = [...this.#documentLayout.querySelectorAll('.sign-editor__document_page img')];\n\t\t\tconst pagesRect = pages.map((page) => {\n\t\t\t\tconst { top, left, width, height } = page.getBoundingClientRect();\n\n\t\t\t\treturn {\n\t\t\t\t\ttop,\n\t\t\t\t\tleft,\n\t\t\t\t\twidth,\n\t\t\t\t\theight,\n\t\t\t\t};\n\t\t\t});\n\t\t\tconst nextPageRect = pagesRect.find((pageRect) => {\n\t\t\t\tif (Math.round(blockRect.top) < Math.round(pageRect.top))\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\treturn false;\n\t\t\t});\n\t\t\tconst pageNum = nextPageRect ? pagesRect.indexOf(nextPageRect) : pagesRect.length;\n\t\t\tconst currentPageRect = pagesRect[pageNum - 1];\n\t\t\tlet position = {\n\t\t\t\ttop: blockRect.top - currentPageRect.top,\n\t\t\t\tleft: blockRect.left - currentPageRect.left,\n\t\t\t\twidth: blockRect.width,\n\t\t\t\theight: blockRect.height,\n\t\t\t\tpage: pageNum,\n\t\t\t};\n\t\t\tposition = this.#pixelToPercent(position, currentPageRect);\n\t\t\tposition.realDocumentWidthPx = realDocumentWidth ? realDocumentWidth : null;\n\t\t\tconst code = block.getCode();\n\t\t\tlet type = 'text';\n\t\t\tswitch (code)\n\t\t\t{\n\t\t\t\tcase 'stamp':\n\t\t\t\tcase 'mystamp':\n\t\t\t\tcase 'sign':\n\t\t\t\tcase 'mysign':\n\t\t\t\t\ttype = 'image';\n\t\t\t}\n\t\t\tpostData.push({\n\t\t\t\tid: block.getId(),\n\t\t\t\tcode: block.getCode(),\n\t\t\t\tdata: block.getData(),\n\t\t\t\tparty: block.getMemberPart(),\n\t\t\t\tstyle: block.getStyle(),\n\t\t\t\tposition,\n\t\t\t\ttype,\n\t\t\t});\n\t\t});\n\n\t\tconst params = {};\n\t\tif (this.#closeDemoContent)\n\t\t{\n\t\t\tparams['closeDemoContent'] = true;\n\t\t}\n\t\tthis.hideResizeArea();\n\n\t\treturn this.#api.saveBlank(\n\t\t\tthis.getDocumentUid(),\n\t\t\tpostData.length > 0 ? postData : [],\n\t\t).then((response) => {\n\n\t\t\tif (!('errors' in response))\n\t\t\t{\n\t\t\t\treturn postData;\n\t\t\t}\n\n\t\t\tif (response.errors[0].customData?.field === 'requisites')\n\t\t\t{\n\t\t\t\tconst popup = new Popup({\n\t\t\t\t\tid: 'sign_document_error_popup',\n\t\t\t\t\ttitleBar: Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_RESTORE_TITLE'),\n\t\t\t\t\tcontent: BX.util.htmlspecialchars(response.errors[0]?.message),\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\tnew Button({\n\t\t\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_RESTORE'),\n\t\t\t\t\t\t\tcolor: ButtonColor.SUCCESS,\n\t\t\t\t\t\t\tonclick: ({ button }) => {\n\t\t\t\t\t\t\t\tconst target = button;\n\t\t\t\t\t\t\t\tDom.addClass(target, 'ui-btn-wait');\n\t\t\t\t\t\t\t\tBackend.controller({\n\t\t\t\t\t\t\t\t\tcommand: 'document.restoreRequisiteFields',\n\t\t\t\t\t\t\t\t\tpostData: {\n\t\t\t\t\t\t\t\t\t\tdocumentId: this.#documentId,\n\t\t\t\t\t\t\t\t\t\tpresetId: response.errors[0]?.customData.presetId,\n\t\t\t\t\t\t\t\t\t\tcode: response.errors[0]?.customData.code,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}).then(() => {\n\t\t\t\t\t\t\t\t\tDom.removeClass(target, 'ui-btn-wait');\n\n\t\t\t\t\t\t\t\t\tthis.#blocks.map((block) => {\n\t\t\t\t\t\t\t\t\t\tif (block.isRemoved())\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tif (block.getCode() === response.errors[0]?.customData.code)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tblock.assign();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\t\t}).catch(() => {\n\t\t\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tnew Button({\n\t\t\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_REQUISITES_RESTORE_BY_HANDS'),\n\t\t\t\t\t\t\tcolor: ButtonColor.INFO,\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tthis.#blocks.map((block) => {\n\t\t\t\t\t\t\t\t\tif (block.isRemoved())\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif (block.getCode() === response.errors[0]?.customData.code)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tconst blockActionButton = document.querySelector(\n\t\t\t\t\t\t\t\t\t\t\t`button[data-id=\"action-${block.getCode()}]`,\n\t\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\t\tif (blockActionButton)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tblockActionButton.click();\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t\tpopup.show();\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst firstError = response.errors[0];\n\t\t\tif (firstError.code === 'REFERENCE_ERROR_FIELD_NOT_SELECTED')\n\t\t\t{\n\t\t\t\tthis.#highlightInvalidBlocks();\n\t\t\t\tconst popup = new Popup({\n\t\t\t\t\tid: 'sign_document_error_popup',\n\t\t\t\t\ttitleBar: Loc.getMessage('SIGN_EDITOR_ERROR_SAVE_REFERENCE_BACK_TITLE'),\n\t\t\t\t\tcontent: BX.util.htmlspecialchars(firstError.message),\n\t\t\t\t\tbuttons: [\n\t\t\t\t\t\tnew Button({\n\t\t\t\t\t\t\ttext: Loc.getMessage('SIGN_EDITOR_ERROR_SAVE_REFERENCE_BACK'),\n\t\t\t\t\t\t\tcolor: ButtonColor.PRIMARY,\n\t\t\t\t\t\t\tonclick: () => {\n\t\t\t\t\t\t\t\tpopup.destroy();\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t\tEventEmitter.subscribeOnce('SidePanel.Slider:onCloseComplete', () => {\n\t\t\t\t\tpopup.destroy();\n\t\t\t\t});\n\t\t\t\tpopup.show();\n\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\treturn postData;\n\t\t});\n\t}\n\n\t/**\n\t * Registers save button.\n\t * @param {DocumentOptions} options\n\t */\n\tonSave(options: DocumentOptions)\n\t{\n\t\tEvent.bind(options.saveButton, 'click', (e) => {\n\t\t\tif (this.#disableEdit)\n\t\t\t{\n\t\t\t\tif (options.afterSaveCallback)\n\t\t\t\t{\n\t\t\t\t\toptions.afterSaveCallback();\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.save()\n\t\t\t\t.then(result => {\n\t\t\t\t\t//todo: we need to parse response and sets id for each new block\n\t\t\t\t\tif (result === true)\n\t\t\t\t\t{\n\t\t\t\t\t\tthis.setSavingMark(true);\n\n\t\t\t\t\t\tif (options.afterSaveCallback)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toptions.afterSaveCallback();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (result !== true)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (options.saveErrorCallback)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\toptions.saveErrorCallback();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t});\n\t}\n\n\t/**\n\t * Registers callback on slider close.\n\t */\n\tonCloseSlider()\n\t{\n\t\tBX.addCustomEvent('SidePanel.Slider:onClose', (event) => {\n\t\t\tif (event.slider.url.indexOf('/sign/edit/') === 0)\n\t\t\t{\n\t\t\t\tif (!this.everythingIsSaved())\n\t\t\t\t{\n\t\t\t\t\tevent.denyAction();\n\n\t\t\t\t\tMessageBox.confirm(\n\t\t\t\t\t\tLoc.getMessage('SIGN_JS_DOCUMENT_SAVE_ALERT_MESSAGE'),\n\t\t\t\t\t\tLoc.getMessage('SIGN_JS_DOCUMENT_SAVE_ALERT_TITLE'),\n\t\t\t\t\t\t(messageBox: MessageBox) => {\n\t\t\t\t\t\t\tthis.setSavingMark(true);\n\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t\tevent.slider.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t\tLoc.getMessage('SIGN_JS_DOCUMENT_SAVE_ALERT_APPLY'),\n\t\t\t\t\t\t(messageBox: MessageBox) => {\n\t\t\t\t\t\t\tmessageBox.close();\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Sets mark to document that everything was saved or not.\n\t * @param {boolean} mark\n\t */\n\tsetSavingMark(mark: boolean)\n\t{\n\t\tthis.setParam('bxSignEditorAllSaved', mark);\n\t}\n\n\t/**\n\t * Returns true, if everything was saved within editor.\n\t * @return {boolean}\n\t */\n\teverythingIsSaved(): boolean\n\t{\n\t\treturn this.getParam('bxSignEditorAllSaved') === true;\n\t}\n\n\tsetParam(name: string, value: any): void\n\t{\n\t\tconst slider = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (slider)\n\t\t{\n\t\t\tslider.getData().set(name, value);\n\t\t}\n\t}\n\n\tgetParam(name: string): any\n\t{\n\t\tconst slider = BX.SidePanel.Instance.getSliderByWindow(window);\n\t\tif (slider)\n\t\t{\n\t\t\treturn slider.getData().get(name);\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\t/**\n\t * Returns true if element with specified top & bottom over dead zone.\n\t * @param {number} top\n\t * @param {number} bottom\n\t * @param {boolean} notAddMargin\n\t * @return {boolean}\n\t */\n\tinDeadZone(top: number, bottom: number, notAddMargin: boolean): boolean\n\t{\n\t\tconst seams = this.getSeams();\n\t\tconst content = document.querySelector('.sign-editor__content');\n\t\ttop += content.scrollTop;\n\t\tbottom += content.scrollTop;\n\t\tif (seams.length > 0 && notAddMargin !== true)\n\t\t{\n\t\t\tconst documentLayoutRect = this.#documentLayout.getBoundingClientRect();\n\t\t\ttop += documentLayoutRect.top;\n\t\t\tbottom += documentLayoutRect.top;\n\t\t}\n\n\t\tfor (\n\t\t\tlet ii = 0,\n\t\t\t\tcc = seams.length; ii < cc; ii++\n\t\t)\n\t\t{\n\t\t\tconst seam = seams[ii];\n\n\t\t\t// top on page, bottom on seam\n\t\t\tif (top <= seam[0] && bottom >= seam[0] && bottom <= seam[1])\n\t\t\t{\n\t\t\t\treturn seam[0] - bottom;\n\t\t\t}\n\n\t\t\t// top on one page, bottom on another (seam in a middle)\n\t\t\tif (top <= seam[0] && bottom >= seam[1])\n\t\t\t{\n\t\t\t\t//seam[0] - bottom >> shift top\n\t\t\t\t//seam[1] - top >> shift bottom\n\t\t\t\treturn seam[0] - bottom;\n\t\t\t}\n\n\t\t\t// block into a seam\n\t\t\tif (top >= seam[0] && bottom <= seam[1])\n\t\t\t{\n\t\t\t\treturn seam[0] - bottom;\n\t\t\t}\n\n\t\t\t// top on seam, bottom on page\n\t\t\tif (top >= seam[0] && top <= seam[1] && bottom >= seam[1])\n\t\t\t{\n\t\t\t\treturn seam[1] - top;\n\t\t\t}\n\n\t\t}\n\n\t\treturn 0;\n\t}\n\n\t#startDisabledEditDocumentTour()\n\t{\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: document.getElementById('sign-editor-btn-edit'),\n\t\t\t\t\ttitle: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_EDIT_TITLE'),\n\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_EDIT_TEXT'),\n\t\t\t\t},\n\t\t\t],\n\t\t\tid: 'sign-tour-guide-onboarding-master-document-edit-disabled',\n\t\t\tautoSave: true,\n\t\t\tsimpleMode: true,\n\t\t});\n\t\tguide.startOnce();\n\t}\n\n\t#startEditDocumentTour()\n\t{\n\t\tconst helpBtnSpotlight = new BX.SpotLight({\n\t\t\ttargetElement: document.getElementById(this.#helpBtnElementId),\n\t\t\ttargetVertex: 'middle-center',\n\t\t\tautoSave: true,\n\t\t\tid: 'sign-spotlight-onboarding-master-document-edit',\n\t\t});\n\n\t\tconst guide = new Guide({\n\t\t\tsteps: [\n\t\t\t\t{\n\t\t\t\t\ttarget: document.getElementById('sign-editor-bar-content'),\n\t\t\t\t\ttitle: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_BLOCKS_TITLE'),\n\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_BLOCKS_TEXT'),\n\t\t\t\t\tposition: 'left',\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttarget: document.getElementById(this.#helpBtnElementId),\n\t\t\t\t\ttitle: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_HELP_TITLE'),\n\t\t\t\t\ttext: Loc.getMessage('SIGN_JS_DOCUMENT_TOUR_BTN_HELP_TEXT'),\n\t\t\t\t\trounded: true,\n\t\t\t\t\tarticle: this.#helpBtnHelperArticleCode,\n\t\t\t\t\tevents: {\n\t\t\t\t\t\tonShow: () => helpBtnSpotlight.show(),\n\t\t\t\t\t\tonClose: () => helpBtnSpotlight.close(),\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t\tid: 'sign-tour-guide-onboarding-master-document-edit',\n\t\t\tautoSave: true,\n\t\t\tsimpleMode: true,\n\t\t});\n\t\tguide.startOnce();\n\t}\n\n\t#highlightInvalidBlocks()\n\t{\n\t\tthis.#blocks.forEach((block) => {\n\t\t\tif (block.isRemoved())\n\t\t\t{\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst code = block.getCode();\n\t\t\tconst isCRM = code === 'reference' || code === 'myreference';\n\t\t\tif (isCRM && Type.isArray(block.getData()))\n\t\t\t{\n\t\t\t\tDom.addClass(block.getLayout(), '--invalid');\n\t\t\t}\n\t\t});\n\t}\n\n\t#onBlockColorStyleChange(updatedBlock: Block, event: BaseEvent)\n\t{\n\t\tif (!['sign', 'mysign'].includes(updatedBlock.getCode()))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst newColor: string | null = event.getData().color ?? null;\n\t\tif (Type.isNull(newColor))\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#blocks\n\t\t\t.filter((block) => updatedBlock.getCode() === block.getCode())\n\t\t\t.forEach((block) => {\n\t\t\t\tif (updatedBlock === block)\n\t\t\t\t{\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tblock.updateColor(newColor, false);\n\t\t\t})\n\t\t;\n\t}\n\n\t#onReferenceBlockFieldSelect(block: Block, event: FieldSelectEvent): void\n\t{\n\t\tif (event.getData().selectedFieldNames.length === 0)\n\t\t{\n\t\t\tconst deleteLatency = 150;\n\t\t\tsetTimeout((): void => this.#onBlockDeleteBecauseFieldNotSelected(block), deleteLatency);\n\t\t}\n\t}\n\n\t#onBlockDeleteBecauseFieldNotSelected(block: Block): void\n\t{\n\t\tblock.remove();\n\t\t// show notification once\n\t\tthis.#cache.remember('notify', () => UI.Notification.Center.notify({\n\t\t\tcontent: Text.encode(Loc.getMessage('SIGN_EDITOR_ERROR_REFERENCE_BLOCK_FIELD_NOT_SELECTED_HINT_TEXT')),\n\t\t\tautoHideDelay: 3000,\n\t\t\twidth: 480,\n\t\t}));\n\t}\n\n\t#unsubscribeFromBlocksEvents(): void\n\t{\n\t\tconst subscriptions: Array<[Block, EventListenerCache]> = Object\n\t\t\t.values(this.#eventListeners)\n\t\t\t.flatMap((subscription) => [...subscription.entries()])\n\t\t;\n\t\tfor (const [block, { subscription, eventName }] of subscriptions)\n\t\t{\n\t\t\tblock.unsubscribe(eventName, subscription);\n\t\t}\n\n\t\tObject.values(this.#eventListeners).forEach((eventListenerCache) => eventListenerCache.clear());\n\t}\n}\n","import { Tag, Reflection, Loc, Dom } from 'main.core';\nimport { BlocksManager } from './blocks/blocksManager';\nimport { EventEmitter } from 'main.core.events';\nimport './style.css';\n\nconst buttonClassList = [\n\t'ui-btn',\n\t'ui-btn-sm',\n\t'ui-btn-round',\n\t'ui-btn-light-border',\n];\nconst firstPartyBlocks = {\n\tmyreference: {\n\t\ttitle: 'SIGN_EDITOR_BLOCK_CRM',\n\t\thint: 'SIGN_EDITOR_BLOCK_CRM_HINT',\n\t},\n\tmyrequisites: {\n\t\ttitle: 'SIGN_EDITOR_BLOCK_REQUISITES',\n\t\thint: 'SIGN_EDITOR_BLOCK_FIRST_PARTY_REQUISITES_HINT',\n\t},\n\tmysign: {\n\t\ttitle: 'SIGN_EDITOR_BLOCK_SIGNATURE',\n\t\thint: 'SIGN_EDITOR_BLOCK_FIRST_PARTY_SIGNATURE_HINT',\n\t},\n\tmystamp: {\n\t\ttitle: 'SIGN_EDITOR_BLOCK_STAMP_MSGVER_1',\n\t\thint: 'SIGN_EDITOR_BLOCK_FIRST_PARTY_STAMP_HINT',\n\t},\n};\nconst partnerBlocks = {\n\treference: { ...firstPartyBlocks.myreference },\n\trequisites: {\n\t\t...firstPartyBlocks.myrequisites,\n\t\thint: 'SIGN_EDITOR_BLOCK_PARTNER_REQUISITES_HINT',\n\t},\n\tsign: {\n\t\t...firstPartyBlocks.mysign,\n\t\thint: 'SIGN_EDITOR_BLOCK_PARTNER_SIGNATURE_HINT',\n\t},\n\tstamp: {\n\t\t...firstPartyBlocks.mystamp,\n\t\thint: 'SIGN_EDITOR_BLOCK_PARTNER_STAMP_HINT',\n\t},\n};\nconst generalBlocks = {\n\ttext: {\n\t\ttitle: 'SIGN_EDITOR_BLOCK_TEXT',\n\t\thint: 'SIGN_EDITOR_BLOCK_TEXT_HINT',\n\t},\n\tdate: {\n\t\ttitle: 'SIGN_EDITOR_BLOCK_DATE',\n\t\thint: 'SIGN_EDITOR_BLOCK_DATE_HINT',\n\t},\n\tnumber: {\n\t\ttitle: 'SIGN_EDITOR_BLOCK_NUMBER',\n\t\thint: 'SIGN_EDITOR_BLOCK_NUMBER_HINT',\n\t},\n};\nconst sections = [\n\t{\n\t\ttitle: 'SIGN_EDITOR_BLOCKS_FIRST_PARTY',\n\t\tblocks: firstPartyBlocks,\n\t\tpart: 1,\n\t},\n\t{\n\t\ttitle: 'SIGN_EDITOR_BLOCKS_PARTNER',\n\t\tblocks: partnerBlocks,\n\t\tpart: 2,\n\t},\n\t{\n\t\ttitle: 'SIGN_EDITOR_BLOCKS_GENERAL',\n\t\tblocks: generalBlocks,\n\t\tpart: 0,\n\t},\n];\nconst helpArticleCode = '16571388';\n\nexport class Editor extends EventEmitter\n{\n\t#sidePanel: BX.SidePanel;\n\t#closeSidePanel: Function;\n\t#dom: HTMLElement;\n\t#documentLayout: HTMLElement;\n\t#blocksManager: BlocksManager;\n\turls: string[];\n\t#popupHint: BX.UI.Hint;\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t\tthis.setEventNamespace('BX.Sign.V2.Editor');\n\t\tconst { Instance } = Reflection.getClass('BX.SidePanel');\n\t\tthis.#sidePanel = Instance;\n\t\tthis.#dom = Tag.render`<div class=\"sign-wizard__scope sign-editor\"></div>`;\n\t\tthis.#documentLayout = Tag.render`\n\t\t\t<div class=\"sign-editor__document\"></div>\n\t\t`;\n\t\tthis.#blocksManager = new BlocksManager({\n\t\t\tdocumentLayout: this.#documentLayout,\n\t\t\tdisableEdit: false,\n\t\t});\n\t\tconst Hint = Reflection.getClass('BX.UI.Hint');\n\t\tthis.#popupHint = Hint?.createInstance({\n\t\t\tpopupParameters: {\n\t\t\t\tautoHide: true,\n\t\t\t\tbindOptions: { position: 'top' },\n\t\t\t\tangle: { position: 'bottom' },\n\t\t\t},\n\t\t});\n\t}\n\n\tset entityData(entityData)\n\t{\n\t\tconst members = Object.values(entityData).map((member) => {\n\t\t\tconst {\n\t\t\t\tid: cid,\n\t\t\t\ttitle: name,\n\t\t\t\tpart,\n\t\t\t\tpresetId,\n\t\t\t\tentityTypeId,\n\t\t\t\tuid,\n\t\t\t} = member;\n\n\t\t\treturn {\n\t\t\t\tcid,\n\t\t\t\tname,\n\t\t\t\tpart,\n\t\t\t\tpresetId,\n\t\t\t\tentityTypeId,\n\t\t\t\tuid,\n\t\t\t};\n\t\t});\n\t\tthis.#blocksManager.addMembers(members);\n\t}\n\n\tasync renderDocument()\n\t{\n\t\tDom.clean(this.#documentLayout);\n\t\tif (this.urls.length === 0)\n\t\t{\n\t\t\treturn;\n\t\t}\n\n\t\tconst { uid = '', isTemplate } = this.documentData;\n\t\t!isTemplate ? this.#toggleEditMode(true) : this.#toggleEditMode(false);\n\t\tthis.#blocksManager.setDocumentUid(uid);\n\t\tconst { promises, fragment } = this.urls.reduce((acc, url) => {\n\t\t\tconst { fragment, promises } = acc;\n\t\t\tconst promise = new Promise((resolve) => {\n\t\t\t\tconst page = Tag.render`\n\t\t\t\t\t<div class=\"sign-editor__document_page\">\n\t\t\t\t\t\t<img src=\"${url}\" onload=\"${resolve}\" />\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t\tDom.append(page, fragment);\n\t\t\t});\n\t\t\tpromises.push(promise);\n\n\t\t\treturn acc;\n\t\t}, {\n\t\t\tfragment: new DocumentFragment(),\n\t\t\tpromises: [],\n\t\t});\n\t\tDom.append(fragment, this.#documentLayout);\n\t\tconst { resizeArea } = this.#blocksManager;\n\t\tDom.append(resizeArea.getLayout(), this.#documentLayout);\n\t\tawait Promise.all(promises);\n\t\tEventEmitter.unsubscribeAll('SidePanel.Slider:onOpenComplete');\n\t\tEventEmitter.subscribeOnce('SidePanel.Slider:onOpenComplete', (event) => {\n\t\t\tconst editorContent = this.#dom.querySelector('.sign-editor__content');\n\t\t\tif (editorContent)\n\t\t\t{\n\t\t\t\teditorContent.scrollTop = 0;\n\t\t\t}\n\t\t\tthis.#blocksManager.initPagesRect();\n\t\t\tthis.#blocksManager.initBlocks(this.documentData.blocks);\n\t\t});\n\t}\n\n\tshow(): Promise\n\t{\n\t\treturn new Promise((resolve) => {\n\t\t\tthis.#closeSidePanel = resolve;\n\t\t\tthis.#sidePanel.open('editor', {\n\t\t\t\tcontentCallback: () => {\n\t\t\t\t\tthis.#render();\n\n\t\t\t\t\treturn this.#dom;\n\t\t\t\t},\n\t\t\t\tevents: {\n\t\t\t\t\tonCloseComplete: () => this.#closeSidePanel(),\n\t\t\t\t},\n\t\t\t});\n\t\t});\n\t}\n\n\t#render()\n\t{\n\t\tDom.clean(this.#dom);\n\t\tDom.append(this.#createHeader(), this.#dom);\n\t\tDom.append(this.#createContent(), this.#dom);\n\t}\n\n\t#createHeader(): HTMLElement\n\t{\n\t\tconst editButtonClassName = [\n\t\t\t'sign-editor__header_edit-btn',\n\t\t\t...buttonClassList,\n\t\t].join(' ');\n\t\tconst saveButtonClassName = [\n\t\t\t'ui-btn-success',\n\t\t\t...buttonClassList.slice(0, -1),\n\t\t].join(' ');\n\t\tconst editButtonTitle = Loc.getMessage('SIGN_EDITOR_EDIT');\n\t\tconst saveButtonTitle = Loc.getMessage('SIGN_EDITOR_SAVE');\n\n\t\treturn Tag.render`\n\t\t\t<div class=\"sign-editor__header\">\n\t\t\t\t<p class=\"sign-editor__header_title\">\n\t\t\t\t\t${Loc.getMessage('SIGN_EDITOR_EDITING')}\n\t\t\t\t</p>\n\t\t\t\t<div class=\"sign-editor__header_right\">\n\t\t\t\t\t<span\n\t\t\t\t\t\tonclick=\"${(event: PointerEvent) => {\n\t\t\t\t\t\t\tconst Helper = Reflection.getClass('BX.Helper');\n\t\t\t\t\t\t\tHelper.show(`redirect=detail&code=${helpArticleCode}`);\n\t\t\t\t\t\t}}\"\n\t\t\t\t\t\tclass=\"sign-editor__header_help\"\n\t\t\t\t\t></span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"${editButtonClassName}\"\n\t\t\t\t\t\ttitle=\"${editButtonTitle}\"\n\t\t\t\t\t\tonclick=\"${() => {\n\t\t\t\t\t\t\tthis.#toggleEditMode(true);\n\t\t\t\t\t\t}}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${editButtonTitle}\n\t\t\t\t\t</span>\n\t\t\t\t\t<span\n\t\t\t\t\t\tclass=\"${saveButtonClassName}\"\n\t\t\t\t\t\ttitle=\"${saveButtonTitle}\"\n\t\t\t\t\t\tonclick=\"${async ({ target }) => {\n\t\t\t\t\t\t\tDom.addClass(target, 'ui-btn-wait');\n\t\t\t\t\t\t\tconst blocks = await this.#blocksManager.save();\n\t\t\t\t\t\t\tDom.removeClass(target, 'ui-btn-wait');\n\t\t\t\t\t\t\tif (!blocks)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tEventEmitter.subscribeOnce('SidePanel.Slider:onCloseComplete', () => {\n\t\t\t\t\t\t\t\tthis.emit('save', { blocks });\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\tthis.#sidePanel.close();\n\t\t\t\t\t\t\tthis.#toggleEditMode(false);\n\t\t\t\t\t\t}}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t${saveButtonTitle}\n\t\t\t\t\t</span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t#createContent(): HTMLElement\n\t{\n\t\tconst editorContent = Tag.render`\n\t\t\t<div class=\"sign-editor__content\">\n\t\t\t\t<div class=\"sign-editor__document-container\">\n\t\t\t\t\t${this.#documentLayout}\n\t\t\t\t</div>\n\t\t\t\t${this.#createSections()}\n\t\t\t</div>\n\t\t`;\n\t\tthis.#blocksManager.setEditorContent(editorContent);\n\t\tthis.#popupHint.popupParameters = {\n\t\t\t...this.#popupHint.popupParameters,\n\t\t\ttargetContainer: editorContent,\n\t\t};\n\n\t\treturn editorContent;\n\t}\n\n\t#createSections(): HTMLElement\n\t{\n\t\tconst sectionsNodes = sections.map((section) => {\n\t\t\tconst entries = Object.entries(section.blocks);\n\t\t\tconst blocks = entries.map(([code, block]) => {\n\t\t\t\tconst { title, hint } = block;\n\n\t\t\t\treturn Tag.render`\n\t\t\t\t\t<div\n\t\t\t\t\t\tclass=\"sign-editor__section_block\"\n\t\t\t\t\t\tdata-code=\"${code}\"\n\t\t\t\t\t\tdata-part=\"${section.part}\"\n\t\t\t\t\t>\n\t\t\t\t\t\t<span>\n\t\t\t\t\t\t\t<span>${Loc.getMessage(title)}</span>\n\t\t\t\t\t\t\t<span data-hint=\"${Loc.getMessage(hint)}\"></span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<span class=\"sign-editor__section_add-block-btn\">\n\t\t\t\t\t\t\t${Loc.getMessage('SIGN_EDITOR_BLOCK_ADD_TO_DOCUMENT')}\n\t\t\t\t\t\t</span>\n\t\t\t\t\t</div>\n\t\t\t\t`;\n\t\t\t});\n\t\t\tthis.#blocksManager.initRepository(blocks);\n\n\t\t\treturn Tag.render`\n\t\t\t\t<div class=\"sign-editor__section\">\n\t\t\t\t\t<p class=\"sign-editor__section_title\">\n\t\t\t\t\t\t${Loc.getMessage(section.title)}\n\t\t\t\t\t</p>\n\t\t\t\t\t${blocks}\n\t\t\t\t</div>\n\t\t\t`;\n\t\t});\n\t\tconst layout = Tag.render`\n\t\t\t<div class=\"sign-editor__sections\">\n\t\t\t\t${sectionsNodes}\n\t\t\t</div>\n\t\t`;\n\t\tthis.#popupHint.init(layout);\n\n\t\treturn layout;\n\t}\n\n\t#toggleEditMode(isEdit: boolean)\n\t{\n\t\tif (isEdit)\n\t\t{\n\t\t\tDom.addClass(this.#dom, '--editable');\n\n\t\t\treturn;\n\t\t}\n\n\t\tDom.removeClass(this.#dom, '--editable');\n\t}\n}\n"],"names":["Dummy","EventEmitter","constructor","block","data","events","onChange","onColorStyleChange","setEventNamespace","isSingleton","isStyleAllowed","setData","setText","text","getInitDimension","width","height","getData","getActionButton","getBlockCaption","getViewContent","Tag","render","TextFormat","encode","toString","replaceAll","onStartChangePosition","onPlaced","onSave","onRemove","onClickOut","forceSave","emit","getStyles","changeStyleColor","color","defaultTextBlockPaddingStyles","padding","Date","onActionClick","BX","calendar","node","getLayout","field","value","bTime","callback_after","date","format","convertBitrixFormat","message","renderView","targetContainer","document","querySelector","popup","popupContainer","parentElement","Dom","append","adjustPosition","bind","Loc","getMessage","Close","MyRequisites","Cache","MemoryCache","getCode","event","stopPropagation","show","Set","fields","filter","createFieldType","has","name","remember","blocksManager","member","getMemberByPart","getMemberPart","cid","entityTypeId","presetId","fieldsetViewer","FieldsetViewer","entityId","onClose","assign","fieldListEditorOptions","fieldsPanelOptions","entity_field_name","fieldName","includes","fieldsFactory","controllerOptions","hideVirtual","hideRequisites","hideSmartDocument","subscribe","hide","hasAccessDeniedError","requestErrors","some","error","code","UI","Notification","Center","notify","content","Text","autoHideDelay","ColorPicker","Reflection","getClass","setRect","element","rect","Object","keys","map","key","parseInt","style","getBlockLayout","options","getMemberSelector","members","selectedValue","menuItems","selectedName","part","memberSelector","length","SignUI","bindSimpleMenu","bindElement","items","actionHandler","innerHTML","getResizeArea","getStylePanel","collectStyles","fonts","fontFamily","fontSizereal","fontSizeValue","fontSize","currentValue","layout","fontColor","getColorSelectorBtn","defaultColorPickerColor","onColorSelect","colorPickerOptions","updateColorSelectorBtnColor","updatedColorPickerOptions","onColorSelected","picker","Event","open","colorPicker","circleColor","Type","isNil","MySign","getPosition","src","dataSrc","base64","getPlaceholderLabel","backgroundPosition","emitEvent","setSelectedColor","colorSelectorBtnLayout","close","colors","allowCustomColor","selectedColor","colorPreview","MyStamp","Uploader","controller","upload","contact","id","label","currentBlock","await","eventData","file","serverId","serverPreviewUrl","Api","title","__view","fileId","memberPart","saveStamp","uid","button","textContent","Number","sliderOnMessageBind","addCustomEvent","window","isEditor","slider","url","getEventId","numeratorData","sender","type","api","getDocumentUid","refreshEntityNumber","crmNumeratorUrl","SidePanel","Instance","cacheable","Reference","isUndefined","Selector","className","then","selectedNames","eventSelectedNames","isStringFilled","push","removeClass","setTimeout","actionButton","defaultCaption","fieldSelector","get","fieldsList","getFieldsList","CONTACT","FIELDS","SMART_DOCUMENT","find","caption","selector","multiple","onFieldSelectEventData","selectedFieldNames","onFieldSelectEvent","BaseEvent","MyReference","COMPANY","blackList","Requisites","tagBody","config","getConfig","Stamp","Sign","updateColor","contentEditable","focus","getText","getContainer","innerText","range","createRange","selectNodeContents","collapse","selection","getSelection","removeAllRanges","addRange","Style","family","property","size","bold","state","italic","underline","through","left","group","center","right","justify","buttonPressed","applyStyles","removeAttribute","updateFontSize","styles","renderStyle","querySelectorAll","action","getAttribute","addClass","indexOf","Block","myrequisites","mysign","mystamp","number","reference","myreference","requisites","sign","stamp","blockContent","blockPanel","blockLoading","blockEditing","pageWithNotAllowed","party","onClick","Error","isString","setPosition","position","top","getBoundingClientRect","Math","round","documentRect","getStyle","getId","showNotAllowedArea","page","transferPositionToPage","pageElement","hideNotAllowedArea","fireAction","onMemberSelect","flag","blockLayouts","currentCode","getBlocks","blockLayout","blocksData","blocksInstance","loadBlocksData","result","isArray","forEach","i","showResizeArea","catch","response","remove","contentTag","clean","toLowerCase","resizeNode","setProperty","observerReady","maxTextSize","parseFloat","isOverflownX","clientHeight","scrollHeight","parentNode","param","resizeText","target","step","minSize","unit","intervalTextResize","clearTimeout","overflow","parent","removeProperty","panelTag","allMembers","getMembers","selectedMembers","getCurrentFontSize","adjustActionsPanel","documentLayout","documentLayoutRect","actionsPanel","actionsPanelRect","marginLeft","getComputedStyle","x","click","hidden","isRemoved","unMuteResizeArea","hideResizeArea","setSavingMark","nodeForPosition","body","blockInitDim","min","scrollTop","offsetHeight","inDeadZone","getPagesGap","Resize","resizeContainer","moveContainer","isDomNode","wrapperLayout","pointRect","display","setAttribute","wrapperLayoutRect","borderDelta","setFullEditorContent","editorContent","getLinkedBlock","e","moving","resizing","initialRect","draggable","Draggable","container","DragAndDrop","HEADLESS","textResize","wrapper","positionLast","bottomResize","areaRect","wrapperRect","hasClass","max","offsetX","offsetY","newPosition","calcDeathTop","notAddDeathMargin","newPositionLinked","dragArea","widthInProcess","source","moveTopDelta","y","marginTop","gapBetweenPages","BlocksManager","blockColorChange","Map","blockReferenceFieldSelect","disableEdit","resizeArea","preventClickOut","closest","activeBlock","initPagesRect","pages","pageRect","pageRectToMath","pageRectKey","isNumber","topBound","bottomBound","offsetWidth","c","getMinPageHeight","getDocumentId","setEditorContent","setDocumentUid","documentUid","getEntityId","getSeams","addMembers","returnMember","getCompanyId","getInitiatorName","muteResizeArea","initBlocks","blocks","initRepository","repositoryItems","item","preventDefault","save","postData","realDocumentWidth","blockRect","pagesRect","nextPageRect","pageNum","currentPageRect","realDocumentWidthPx","saveBlank","errors","customData","Popup","titleBar","util","htmlspecialchars","buttons","Button","ButtonColor","SUCCESS","onclick","Backend","command","documentId","destroy","INFO","blockActionButton","firstError","PRIMARY","subscribeOnce","saveButton","afterSaveCallback","saveErrorCallback","onCloseSlider","everythingIsSaved","denyAction","MessageBox","confirm","messageBox","mark","setParam","getParam","getSliderByWindow","set","undefined","bottom","notAddMargin","seams","ii","cc","seam","widthPx","heightPx","pageImageRect","pixelPosition","seamShift","newBlock","existedSignBlock","signColor","newBlockCode","colorChangeListener","subscription","eventName","onFieldSelectListener","guide","Guide","steps","getElementById","autoSave","simpleMode","startOnce","helpBtnSpotlight","SpotLight","targetElement","targetVertex","rounded","article","onShow","isCRM","updatedBlock","newColor","isNull","deleteLatency","subscriptions","values","flatMap","entries","unsubscribe","eventListenerCache","clear","buttonClassList","firstPartyBlocks","hint","partnerBlocks","generalBlocks","sections","helpArticleCode","Editor","Hint","createInstance","popupParameters","autoHide","bindOptions","angle","entityData","renderDocument","urls","isTemplate","documentData","promises","fragment","reduce","acc","promise","Promise","resolve","DocumentFragment","all","unsubscribeAll","contentCallback","onCloseComplete","editButtonClassName","join","saveButtonClassName","slice","editButtonTitle","saveButtonTitle","Helper","sectionsNodes","section","init","isEdit"],"mappings":"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"}